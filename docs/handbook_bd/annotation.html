<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.5 Annotation | patRoon handbook</title>
  <meta name="description" content="4.5 Annotation | patRoon handbook" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4.5 Annotation | patRoon handbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.5 Annotation | patRoon handbook" />
  
  
  

<meta name="author" content="Rick Helmus" />


<meta name="date" content="2022-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="incorpAdductIso.html"/>
<link rel="next" href="processing.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="automatic-installation-windows-only.html"><a href="automatic-installation-windows-only.html"><i class="fa fa-check"></i><b>2.1</b> Automatic installation (Windows only)</a></li>
<li class="chapter" data-level="2.2" data-path="docker-image.html"><a href="docker-image.html"><i class="fa fa-check"></i><b>2.2</b> Docker image</a></li>
<li class="chapter" data-level="2.3" data-path="manual-installation.html"><a href="manual-installation.html"><i class="fa fa-check"></i><b>2.3</b> Manual installation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manual-installation.html"><a href="manual-installation.html#r-prerequisites"><i class="fa fa-check"></i><b>2.3.1</b> R prerequisites</a></li>
<li class="chapter" data-level="2.3.2" data-path="manual-installation.html"><a href="manual-installation.html#other-dependencies"><i class="fa fa-check"></i><b>2.3.2</b> Other dependencies</a></li>
<li class="chapter" data-level="2.3.3" data-path="manual-installation.html"><a href="manual-installation.html#patroon-installation"><i class="fa fa-check"></i><b>2.3.3</b> patRoon installation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-concepts.html"><a href="workflow-concepts.html"><i class="fa fa-check"></i><b>3</b> Workflow concepts</a></li>
<li class="chapter" data-level="4" data-path="generating-workflow-data.html"><a href="generating-workflow-data.html"><i class="fa fa-check"></i><b>4</b> Generating workflow data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preparations.html"><a href="preparations.html"><i class="fa fa-check"></i><b>4.1</b> Preparations</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preparations.html"><a href="preparations.html#data-pre-treatment"><i class="fa fa-check"></i><b>4.1.1</b> Data pre-treatment</a></li>
<li class="chapter" data-level="4.1.2" data-path="preparations.html"><a href="preparations.html#anaInfo"><i class="fa fa-check"></i><b>4.1.2</b> Analysis information</a></li>
<li class="chapter" data-level="4.1.3" data-path="preparations.html"><a href="preparations.html#newProject"><i class="fa fa-check"></i><b>4.1.3</b> Automatic project generation with newProject()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4.2</b> Features</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="features.html"><a href="features.html#finding-and-grouping-features"><i class="fa fa-check"></i><b>4.2.1</b> Finding and grouping features</a></li>
<li class="chapter" data-level="4.2.2" data-path="features.html"><a href="features.html#suspscr"><i class="fa fa-check"></i><b>4.2.2</b> Suspect screening</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="componentization.html"><a href="componentization.html"><i class="fa fa-check"></i><b>4.3</b> Componentization</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="componentization.html"><a href="componentization.html#componentsChrom"><i class="fa fa-check"></i><b>4.3.1</b> Features with similar chromatographic behaviour</a></li>
<li class="chapter" data-level="4.3.2" data-path="componentization.html"><a href="componentization.html#homologues-series"><i class="fa fa-check"></i><b>4.3.2</b> Homologues series</a></li>
<li class="chapter" data-level="4.3.3" data-path="componentization.html"><a href="componentization.html#compClust"><i class="fa fa-check"></i><b>4.3.3</b> Intensity and MS/MS similarity</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html"><i class="fa fa-check"></i><b>4.4</b> Incorporating adduct and isotopic data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#selecting-features-with-preferential-adductsisotopes"><i class="fa fa-check"></i><b>4.4.1</b> Selecting features with preferential adducts/isotopes</a></li>
<li class="chapter" data-level="4.4.2" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#setting-adduct-annotations-for-feature-groups"><i class="fa fa-check"></i><b>4.4.2</b> Setting adduct annotations for feature groups</a></li>
<li class="chapter" data-level="4.4.3" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#useAdductAnn"><i class="fa fa-check"></i><b>4.4.3</b> Using adduct annotations in the workflow</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>4.5</b> Annotation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="annotation.html"><a href="annotation.html#ms-peak-lists"><i class="fa fa-check"></i><b>4.5.1</b> MS peak lists</a></li>
<li class="chapter" data-level="4.5.2" data-path="annotation.html"><a href="annotation.html#formulae"><i class="fa fa-check"></i><b>4.5.2</b> Formulae</a></li>
<li class="chapter" data-level="4.5.3" data-path="annotation.html"><a href="annotation.html#compounds"><i class="fa fa-check"></i><b>4.5.3</b> Compounds</a></li>
<li class="chapter" data-level="4.5.4" data-path="annotation.html"><a href="annotation.html#suspAnn"><i class="fa fa-check"></i><b>4.5.4</b> Suspect annotation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>5</b> Processing workflow data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="inspecting-results.html"><a href="inspecting-results.html"><i class="fa fa-check"></i><b>5.1</b> Inspecting results</a></li>
<li class="chapter" data-level="5.2" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>5.2</b> Filtering</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="filtering.html"><a href="filtering.html#features-1"><i class="fa fa-check"></i><b>5.2.1</b> Features</a></li>
<li class="chapter" data-level="5.2.2" data-path="filtering.html"><a href="filtering.html#suspect-screening"><i class="fa fa-check"></i><b>5.2.2</b> Suspect screening</a></li>
<li class="chapter" data-level="5.2.3" data-path="filtering.html"><a href="filtering.html#annotation-1"><i class="fa fa-check"></i><b>5.2.3</b> Annotation</a></li>
<li class="chapter" data-level="5.2.4" data-path="filtering.html"><a href="filtering.html#components"><i class="fa fa-check"></i><b>5.2.4</b> Components</a></li>
<li class="chapter" data-level="5.2.5" data-path="filtering.html"><a href="filtering.html#negation"><i class="fa fa-check"></i><b>5.2.5</b> Negation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>5.3</b> Subsetting</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="subset.html"><a href="subset.html#prioritization-workflow"><i class="fa fa-check"></i><b>5.3.1</b> Prioritization workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="deleting-data.html"><a href="deleting-data.html"><i class="fa fa-check"></i><b>5.4</b> Deleting data</a></li>
<li class="chapter" data-level="5.5" data-path="unOv.html"><a href="unOv.html"><i class="fa fa-check"></i><b>5.5</b> Unique and overlapping features</a></li>
<li class="chapter" data-level="5.6" data-path="specSim.html"><a href="specSim.html"><i class="fa fa-check"></i><b>5.6</b> MS similarity</a></li>
<li class="chapter" data-level="5.7" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5.7</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="visualization.html"><a href="visualization.html#vis_feat_ann"><i class="fa fa-check"></i><b>5.7.1</b> Features and annatation data</a></li>
<li class="chapter" data-level="5.7.2" data-path="visualization.html"><a href="visualization.html#visComp"><i class="fa fa-check"></i><b>5.7.2</b> Overlapping and unique data</a></li>
<li class="chapter" data-level="5.7.3" data-path="visualization.html"><a href="visualization.html#ms-similarity"><i class="fa fa-check"></i><b>5.7.3</b> MS similarity</a></li>
<li class="chapter" data-level="5.7.4" data-path="visualization.html"><a href="visualization.html#plotClust"><i class="fa fa-check"></i><b>5.7.4</b> Hierarchical clustering results</a></li>
<li class="chapter" data-level="5.7.5" data-path="visualization.html"><a href="visualization.html#generating-eics-in-dataanalysis"><i class="fa fa-check"></i><b>5.7.5</b> Generating EICs in DataAnalysis</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="intReview.html"><a href="intReview.html"><i class="fa fa-check"></i><b>5.8</b> Interactively explore and review data</a></li>
<li class="chapter" data-level="5.9" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>5.9</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="setsWorkflow.html"><a href="setsWorkflow.html"><i class="fa fa-check"></i><b>6</b> Sets workflows</a>
<ul>
<li class="chapter" data-level="6.1" data-path="initiating-a-sets-workflow.html"><a href="initiating-a-sets-workflow.html"><i class="fa fa-check"></i><b>6.1</b> Initiating a sets workflow</a></li>
<li class="chapter" data-level="6.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html"><i class="fa fa-check"></i><b>6.2</b> Generating sets workflow data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#componentization-1"><i class="fa fa-check"></i><b>6.2.1</b> Componentization</a></li>
<li class="chapter" data-level="6.2.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#formula-and-compound-annotation"><i class="fa fa-check"></i><b>6.2.2</b> Formula and compound annotation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="setsAdducts.html"><a href="setsAdducts.html"><i class="fa fa-check"></i><b>6.3</b> Selecting adducts to improve grouping</a></li>
<li class="chapter" data-level="6.4" data-path="processing-data.html"><a href="processing-data.html"><i class="fa fa-check"></i><b>6.4</b> Processing data</a></li>
<li class="chapter" data-level="6.5" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>6.5</b> Advanced</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="advanced.html"><a href="advanced.html#initiating-a-sets-workflow-from-feature-groups"><i class="fa fa-check"></i><b>6.5.1</b> Initiating a sets workflow from feature groups</a></li>
<li class="chapter" data-level="6.5.2" data-path="advanced.html"><a href="advanced.html#inspecting-and-converting-set-objects"><i class="fa fa-check"></i><b>6.5.2</b> Inspecting and converting set objects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="TPs.html"><a href="TPs.html"><i class="fa fa-check"></i><b>7</b> Transformation product screening</a>
<ul>
<li class="chapter" data-level="7.1" data-path="genTPs.html"><a href="genTPs.html"><i class="fa fa-check"></i><b>7.1</b> Obtaining transformation product data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="genTPs.html"><a href="genTPs.html#parent-input"><i class="fa fa-check"></i><b>7.1.1</b> Parent input</a></li>
<li class="chapter" data-level="7.1.2" data-path="genTPs.html"><a href="genTPs.html#processing-data-1"><i class="fa fa-check"></i><b>7.1.2</b> Processing data</a></li>
<li class="chapter" data-level="7.1.3" data-path="genTPs.html"><a href="genTPs.html#TPsCustom"><i class="fa fa-check"></i><b>7.1.3</b> Custom libraries and transformations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html"><i class="fa fa-check"></i><b>7.2</b> Linking parent and transformation product features</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#componentization-2"><i class="fa fa-check"></i><b>7.2.1</b> Componentization</a></li>
<li class="chapter" data-level="7.2.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#TPsProc"><i class="fa fa-check"></i><b>7.2.2</b> Processing data</a></li>
<li class="chapter" data-level="7.2.3" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#omitting-transformation-product-input"><i class="fa fa-check"></i><b>7.2.3</b> Omitting transformation product input</a></li>
<li class="chapter" data-level="7.2.4" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#reporting-tp-components"><i class="fa fa-check"></i><b>7.2.4</b> Reporting TP components</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="TPsExamples.html"><a href="TPsExamples.html"><i class="fa fa-check"></i><b>7.3</b> Example workflows</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx1"><i class="fa fa-check"></i><b>7.3.1</b> Screen predicted TPs for targets</a></li>
<li class="chapter" data-level="7.3.2" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx2"><i class="fa fa-check"></i><b>7.3.2</b> Screening TPs from a library for suspects</a></li>
<li class="chapter" data-level="7.3.3" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx3"><i class="fa fa-check"></i><b>7.3.3</b> Non-target screening of predicted TPs</a></li>
<li class="chapter" data-level="7.3.4" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx4"><i class="fa fa-check"></i><b>7.3.4</b> Non-target screening of TPs by annotation similarities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced_usage.html"><a href="advanced_usage.html"><i class="fa fa-check"></i><b>8</b> Advanced usage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="adducts.html"><a href="adducts.html"><i class="fa fa-check"></i><b>8.1</b> Adducts</a></li>
<li class="chapter" data-level="8.2" data-path="fOpt.html"><a href="fOpt.html"><i class="fa fa-check"></i><b>8.2</b> Feature parameter optimization</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="fOpt.html"><a href="fOpt.html#parameter-sets"><i class="fa fa-check"></i><b>8.2.1</b> Parameter sets</a></li>
<li class="chapter" data-level="8.2.2" data-path="fOpt.html"><a href="fOpt.html#processing-optmization-results"><i class="fa fa-check"></i><b>8.2.2</b> Processing optmization results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="peakQual.html"><a href="peakQual.html"><i class="fa fa-check"></i><b>8.3</b> Chromatographic peak qualities</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="peakQual.html"><a href="peakQual.html#applying-machine-learning-with-metaclean"><i class="fa fa-check"></i><b>8.3.1</b> Applying machine learning with MetaClean</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="exporting-and-converting-feature-data.html"><a href="exporting-and-converting-feature-data.html"><i class="fa fa-check"></i><b>8.4</b> Exporting and converting feature data</a></li>
<li class="chapter" data-level="8.5" data-path="consensus.html"><a href="consensus.html"><i class="fa fa-check"></i><b>8.5</b> Algorithm consensus</a></li>
<li class="chapter" data-level="8.6" data-path="compclust.html"><a href="compclust.html"><i class="fa fa-check"></i><b>8.6</b> Compound clustering</a></li>
<li class="chapter" data-level="8.7" data-path="basic-quantitative-and-regression-analysis.html"><a href="basic-quantitative-and-regression-analysis.html"><i class="fa fa-check"></i><b>8.7</b> Basic quantitative and regression analysis</a></li>
<li class="chapter" data-level="8.8" data-path="FCCalc.html"><a href="FCCalc.html"><i class="fa fa-check"></i><b>8.8</b> Fold changes</a></li>
<li class="chapter" data-level="8.9" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>8.9</b> Caching</a></li>
<li class="chapter" data-level="8.10" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>8.10</b> Parallelization</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="parallelization.html"><a href="parallelization.html#parellization-of-r-functions"><i class="fa fa-check"></i><b>8.10.1</b> Parellization of R functions</a></li>
<li class="chapter" data-level="8.10.2" data-path="parallelization.html"><a href="parallelization.html#multiprocessing"><i class="fa fa-check"></i><b>8.10.2</b> Multiprocessing</a></li>
<li class="chapter" data-level="8.10.3" data-path="parallelization.html"><a href="parallelization.html#notes-when-using-parallelization-with-futures"><i class="fa fa-check"></i><b>8.10.3</b> Notes when using parallelization with futures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">patRoon handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="annotation" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Annotation</h2>
<p>The annotation consists of collecting MS peak lists and then formula and/or compound annotation:</p>
<div id="htmlwidget-4f664e1d63ba2def637d" style="width:500px;height:120px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f664e1d63ba2def637d">{"x":{"diagram":"\ndigraph Annotation {\n  graph [ rankdir = LR ]\n  node [ shape = box,\n         fixedsize = true,\n         width = 2.3,\n         height = 1,\n         fontsize = 18,\n         fillcolor = darkseagreen1,\n         style = filled ]\n\n    \"MS peak lists\" -> \"Formula annotation\"\n    \"MS peak lists\" -> \"Compound annotation\"\n    \"Formula annotation\":n -> \"Suspect annotation\":n [style = dotted]\n    \"Compound annotation\":s -> \"Suspect annotation\":s [style = dotted]\n    \"Formula annotation\":e -> \"Compound annotation\":e [style = dotted, constraint = false]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Note that compound annotation is normally not dependent upon formula annotation. However, formula data can be used to improve ranking of candidates afterwards by the <code>addFormulaScoring()</code> function, which will be discussed later in this section. Furthermore, suspect annotation is not mandatory, and may use data from peak lists, formulae and/or comounds.</p>
<div id="ms-peak-lists" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> MS peak lists</h3>
<table>
<colgroup>
<col width="10%" />
<col width="45%" />
<col width="44%" />
</colgroup>
<thead>
<tr class="header">
<th>Algorithm</th>
<th>Usage</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://bioconductor.org/packages/release/bioc/html/mzR.html">mzR</a></td>
<td><code>generateMSPeakLists(algorithm = "mzr", ...)</code></td>
<td>Uses <a href="https://bioconductor.org/packages/release/bioc/html/mzR.html">mzR</a> for spectra retrieval. Recommended default.</td>
</tr>
<tr class="even">
<td>DataAnalysis</td>
<td><code>generateMSPeakLists(algorithm = "bruker", ...)</code></td>
<td>Loads data after automatically generating MS and MS/MS spectra in DataAnalysis</td>
</tr>
<tr class="odd">
<td>DataAnalysis FMF</td>
<td><code>generateMSPeakLists(algorithm = "brukerfmf", ...)</code></td>
<td>Uses spectra from the <em>find molecular features</em> algorithm.</td>
</tr>
</tbody>
</table>
<p>The recommended default algorithm is <code>mzr</code>: this algorithm is generally faster and is not limited to a vendor data format as it will read the open <code>mzML</code> and <code>mzXML</code> file formats. On the other hand, when DataAnalysis is used with Bruker data the spectra can be automatically background subtracted and there is no need for file conversion. Note that the <code>brukerfmf</code> algorithm only works when <code>findFeatures()</code> was called with the <code>bruker</code> algorithm.</p>
<p>When <code>generateMSPeakists()</code> is called it will</p>
<ol style="list-style-type: decimal">
<li>Find all MS and MS/MS spectra that ‘belong’ to a feature. For MS spectra this means that all spectra close to the retention time of a feature will be collected. In addition, for MS/MS normally only spectra will be considered that have a precursor mass close to that of the feature (however, this can be disabled for data that was recorded with data independent acquisition (DIA, MS^E, bbCID, …)).</li>
<li>Average all MS and MS/MS spectra to produce peak lists for each feature.</li>
<li>Average all peak lists for features within the same group.</li>
</ol>
<p>Data from either (2) or (3) is used for subsequent annotation steps. Formula calculation can use either (as a trade-off between possibly more accurate results by outlier removal <em>vs</em> speed), whereas compound annotation will always use data from (3) since annotating single features (as opposed to their groups) would take a very long time.</p>
<p>There are several common function arguments to <code>generateMSPeakLists()</code> that can be used to optimize its behaviour:</p>
<!-- UNDONE: add topMost for Bruker when it's there -->
<table>
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="55%" />
</colgroup>
<thead>
<tr class="header">
<th>Argument</th>
<th>Algorithm(s)</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>maxMSRtWindow</code></td>
<td><code>mzr</code>, <code>bruker</code></td>
<td>Maximum time window +/- the feature retention time (in seconds) to collect spectra for averaging. Higher values may significantly increase processing times.</td>
</tr>
<tr class="even">
<td><code>precursorMzWindow</code></td>
<td><code>mzr</code></td>
<td>Maximum precursor <em>m/z</em> search window to find MS/MS spectra. Set to <code>NULL</code> to disable (i.e. for DIA experiments).</td>
</tr>
<tr class="odd">
<td><code>topMost</code></td>
<td><code>mzr</code></td>
<td>Only retain feature data for no more than this amount analyses with highest intensity. For instance, a value of <em>1</em> will only keep peak lists for the feature with highest intensity in a feature group.</td>
</tr>
<tr class="even">
<td><code>bgsubtr</code></td>
<td><code>bruker</code></td>
<td>Perform background subtraction (if the spectra type supports this, e.g. MS and bbCID)</td>
</tr>
<tr class="odd">
<td><code>minMSIntensity</code>, <code>minMSMSIntensity</code></td>
<td><code>bruker</code>, <code>brukerfmf</code></td>
<td>Minimum MS and MS/MS intensity. Note that DataAnalysis reports many zero intensity peaks so a value of at least <em>1</em> is recommended.</td>
</tr>
<tr class="even">
<td><code>MSMSType</code></td>
<td><code>bruker</code></td>
<td>The type of spectra that should be used for MSMS: <code>"BBCID"</code> for bbCID experiments, otherwise <code>"MSMS"</code> (the default).</td>
</tr>
</tbody>
</table>
<p>In addition, several parameters can be set that affect spectral averaging. These parameters are passed as a <code>list</code> to the <code>avgFeatParams</code> (<code>mzr</code> algorithm only) and <code>avgFGroupParams</code> arguments, which affect averaging of feature and feature group data, respectively. Some typical parameters include:</p>
<ul>
<li><code>clusterMzWindow</code>: Maximum <em>m/z</em> window used to cluster mass peaks when averaging. The better the MS resolution, the lower this value should be.</li>
<li><code>topMost</code>: Retain no more than this amount of most intense mass peaks. Useful to filter out ‘noisy’ peaks.</li>
<li><code>minIntensityPre</code> / <code>minIntensityPost</code>: Mass peaks below this intensity will be removed before/after averaging.</li>
</ul>
<p>See <code>?generateMSPeakLists</code> for all possible parameters.</p>
<p>A suitable list object to set averaging parameters can be obtained with the <code>getDefAvgPListParams()</code> function.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="annotation.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lower default clustering window, other settings remain default</span></span>
<span id="cb32-2"><a href="annotation.html#cb32-2" aria-hidden="true" tabindex="-1"></a>avgPListParams <span class="ot">&lt;-</span> <span class="fu">getDefAvgPListParams</span>(<span class="at">clusterMzWindow =</span> <span class="fl">0.001</span>)</span>
<span id="cb32-3"><a href="annotation.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="annotation.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to both feature and feature group averaging</span></span>
<span id="cb32-5"><a href="annotation.html#cb32-5" aria-hidden="true" tabindex="-1"></a>plists <span class="ot">&lt;-</span> <span class="fu">generateMSPeakLists</span>(fGroups, <span class="st">&quot;mzr&quot;</span>, <span class="at">avgFeatParams =</span> avgPListParams, <span class="at">avgFGroupParams =</span> avgPListParams)</span></code></pre></div>
</div>
<div id="formulae" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Formulae</h3>
<p>Formulae can be automatically calculated for all features using the <code>generateFormulas()</code> function. The following algorithms are currently supported:</p>
<table>
<colgroup>
<col width="11%" />
<col width="43%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th>Algorithm</th>
<th>Usage</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://sourceforge.net/projects/genform/">GenForm</a></td>
<td><code>generateFormulas(algorithm = "genform", ...)</code></td>
<td>Bundled with <code>patRoon</code>. Reasonable default.</td>
</tr>
<tr class="even">
<td><a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a></td>
<td><code>generateFormulas(algorithm = "sirius", ...)</code></td>
<td>Requires MS/MS data.</td>
</tr>
<tr class="odd">
<td>DataAnalysis</td>
<td><code>generateFormulas(algorithm = "bruker", ...)</code></td>
<td>Requires FMF features (i.e. <code>findFeatures(algorithm = "bruker", ...)</code>). Uses <em>SmartFormula</em> algorithms.</td>
</tr>
</tbody>
</table>
<p>Calculation with <a href="https://sourceforge.net/projects/genform/">GenForm</a> is often a good default. It is fast and basic rules can be applied to filter out obvious non-existing formulae. A possible drawback of GenForm, however, is that may become slow when many candidates are calculated, for instance, due to a relative high feature <em>m/z</em> (e.g. &gt;600) or loose elemental restricitions. More thorough calculation is performed with <a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a>: this algorithm often yields fewer and often more plausible results. However, <a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a> requires MS/MS data (hence features without will not have results) and formula prediction may not work well for compounds that structurally deviate from the training sets used by <a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a>. Calculation with DataAnalysis is only possible when features are obtained with DataAnalysis as well. An advantage is that analysis files do not have to be converted, however, compared to other algorithms calculation is often relative slow.</p>
<p>There are two methods for formula assignment:</p>
<ol style="list-style-type: decimal">
<li>Formulae are first calculated for each individual feature within a feature group. These results are then pooled, outliers are removed and remaining formulae are assigned to the feature group (i.e. <code>calculateFeatures = TRUE</code>).</li>
<li>Formulae are directly calculated for each feature group by using group averaged peak lists (see previous section) (i.e. <code>calculateFeatures = FALSE</code>).</li>
</ol>
<p>The first method is more thorough and the possibility to remove outliers may sometimes result in better formula assignment. However, the second method is much faster and generally recommended for large number of analyses.</p>
<p>By default, formulae are either calculated by <em>only</em> MS/MS data (SIRIUS) or with both MS <em>and</em> MS/MS data (GenForm/Bruker). The latter also allows formula calculation when no MS/MS data is present. Furthermore, with Bruker algorithms, data from both MS and MS/MS formula data can be combined to allow inclusion of candidates that would otherwise be excluded by e.g. poor MS/MS data. However, a disadvantage is that formulae needs to be calculated twice. The <code>MSMode</code> argument (listed below) can be used to customize this behaviour.</p>
<p>An overview of common parameters that are typically set to customize formula calculation is listed below.</p>
<table>
<colgroup>
<col width="14%" />
<col width="16%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th>Argument</th>
<th>Algorithm(s)</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>relMzDev</td>
<td><code>genform</code>, <code>sirius</code></td>
<td>The maximum relative <em>m/z</em> deviation for a formula to be considered (in <em>ppm</em>).</td>
</tr>
<tr class="even">
<td>elements</td>
<td><code>genform</code>, <code>sirius</code></td>
<td>Which elements to consider. By default <code>"CHNOP"</code>. Try to limit possible elements as much as possible.</td>
</tr>
<tr class="odd">
<td>calculateFeatures</td>
<td><code>genform</code>, <code>sirius</code></td>
<td>Whether formulae should be calculated first for all features (see discussion above) (always <code>TRUE</code> with DataAnalysis).</td>
</tr>
<tr class="even">
<td>featThresholdAnn</td>
<td>All</td>
<td>Minimum relative amount (<em>0-1</em>) that a candidate formula for a feature group should be found among all annotated features (e.g. <em>1</em> means that a candidate is only considered if it was assigned to all annotated features).</td>
</tr>
<tr class="odd">
<td>adduct</td>
<td>All</td>
<td>The adduct to consider for calculation (e.g. <code>"[M+H]+"</code>, <code>"[M-H]-"</code>, more details in the <a href="adducts.html#adducts">adduct section</a>). Don’t set this when <a href="incorpAdductIso.html#incorpAdductIso">adduct annotations</a> are available.</td>
</tr>
<tr class="even">
<td>MSMode</td>
<td><code>genform</code>, <code>bruker</code></td>
<td>Whether formulae should be generated only from MS data (<code>"ms"</code>), MS/MS data (<code>"msms"</code>) or both (<code>"both"</code>). The latter is default, see discussion above.</td>
</tr>
<tr class="odd">
<td>profile</td>
<td><code>sirius</code></td>
<td>Instrument profile, e.g. <code>"qtof"</code>, <code>"orbitrap"</code>, <code>"fticr"</code>.</td>
</tr>
</tbody>
</table>
<p>Some typical examples:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="annotation.html#cb33-1" aria-hidden="true" tabindex="-1"></a>formulasGF <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, mslists, <span class="st">&quot;genform&quot;</span>) <span class="co"># GenForm, default settings</span></span>
<span id="cb33-2"><a href="annotation.html#cb33-2" aria-hidden="true" tabindex="-1"></a>formulasGF2 <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, mslists, <span class="st">&quot;genform&quot;</span>, <span class="at">calculateFeatures =</span> <span class="cn">FALSE</span>) <span class="co"># direct feature group assignment (faster)</span></span>
<span id="cb33-3"><a href="annotation.html#cb33-3" aria-hidden="true" tabindex="-1"></a>formulasSIR <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, mslists, <span class="st">&quot;sirius&quot;</span>, <span class="at">elements =</span> <span class="st">&quot;CHNOPSClBr&quot;</span>) <span class="co"># SIRIUS, common elements for pollutant</span></span>
<span id="cb33-4"><a href="annotation.html#cb33-4" aria-hidden="true" tabindex="-1"></a>formulasSIR2 <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, mslists, <span class="st">&quot;sirius&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M-H]-&quot;</span>) <span class="co"># SIRIUS, negative ionization</span></span>
<span id="cb33-5"><a href="annotation.html#cb33-5" aria-hidden="true" tabindex="-1"></a>formulasBr <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, mslists, <span class="st">&quot;bruker&quot;</span>, <span class="at">MSMode =</span> <span class="st">&quot;MSMS&quot;</span>) <span class="co"># Only consider MSMS data (SmartFormula3D)</span></span></code></pre></div>
</div>
<div id="compounds" class="section level3" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Compounds</h3>
<p>An important step in a typical non-target workflow is structural identification for features of interest. Afterall, this information may finally reveal <em>what</em> a feature is. The first step is to find all possible structures in a database that may be assigned to the feature (based on e.g. monoisotopic mass or formula). These candidates are then scored to rank likely candidates, for instance, on correspondence with in-silico or library MS/MS spectra and environmental relevance.</p>
<p>Structure assignment in <code>patRoon</code> is performed automatically for all feature groups with the <code>generateCompounds()</code> function. Currently, this function supports two algorithms:</p>
<table>
<colgroup>
<col width="22%" />
<col width="38%" />
<col width="39%" />
</colgroup>
<thead>
<tr class="header">
<th>Algorithm</th>
<th>Usage</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="http://ipb-halle.github.io/MetFrag/">MetFrag</a></td>
<td><code>generateCompounds(algorithm = "metfrag", ...)</code></td>
<td>Supports many databases (including custom) and scorings for candidate ranking.</td>
</tr>
<tr class="even">
<td><a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a> with <a href="https://www.csi-fingerid.uni-jena.de/">CSI:FingerID</a></td>
<td><code>generateCompounds(algorithm = "sirius", ...)</code></td>
<td>Incorporates prior comprohensive formula calculations.</td>
</tr>
</tbody>
</table>
<p>Compound annotation is often a relative time and resource intensive procedure. For this reason, features are not annotated individually, but instead a feature group as a whole is annotated, which generally saves significant amounts of computational requirements. Nevertheless, it is not uncommon that this is the most time consuming step in the workflow. For this reason, prioritization of features is highly important, even more so to avoid ‘abusing’ servers when an online database is used for compound retrieval.</p>
<p>Selecting the right database is important for proper candidate assignment. Afterall, if the ‘right’ chemical compound is not present in the used database, it is impossible to assign the correct structure. Luckily, however, several large databases such as <a href="https://pubchem.ncbi.nlm.nih.gov/">PubChem</a> and <a href="http://www.chemspider.com/">ChemSpider</a> are openly available which contain tens of millions of compounds. On the other hand, these databases may also lead to many unlikely candidates and therefore more specialized (or custom databases) may be preferred. Which database will be used is dictated by the <code>database</code> argument to <code>generateCompounds()</code>, currently the following options exist:</p>
<!-- UNDONE: add missing databases when support is added -->
<table>
<colgroup>
<col width="29%" />
<col width="35%" />
<col width="35%" />
</colgroup>
<thead>
<tr class="header">
<th>Database</th>
<th>Algorithm(s)</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>pubchem</code></td>
<td><code>"metfrag"</code>, <code>"sirius"</code></td>
<td><a href="https://pubchem.ncbi.nlm.nih.gov/">PubChem</a> is currently the largest compound database and is used by default.</td>
</tr>
<tr class="even">
<td><code>chemspider</code></td>
<td><code>"metfrag"</code></td>
<td><a href="http://www.chemspider.com/">ChemSpider</a> is another large database. Requires security token from <a href="http://www.chemspider.com/AboutServices.aspx">here</a> (see next section).</td>
</tr>
<tr class="odd">
<td><code>comptox</code></td>
<td><code>"metfrag"</code></td>
<td>The EPA <a href="https://comptox.epa.gov/dashboard">CompTox</a> contains many compounds and scorings relevant to environmental studies. Needs manual download (see next section).</td>
</tr>
<tr class="even">
<td><code>pubchemlite</code></td>
<td><code>"metfrag"</code></td>
<td>A specialized subset of the PubChem database. Needs manual download (see next section).</td>
</tr>
<tr class="odd">
<td><code>for-ident</code></td>
<td><code>"metfrag"</code></td>
<td>The <a href="https://water.for-ident.org">FOR-IDENT</a> (STOFF-IDENT) database for water related substances.</td>
</tr>
<tr class="even">
<td><code>kegg</code></td>
<td><code>"metfrag"</code>, <code>"sirius"</code></td>
<td>The <a href="https://www.genome.jp/kegg/">KEGG</a> database for biological compounds</td>
</tr>
<tr class="odd">
<td><code>hmdb</code></td>
<td><code>"metfrag"</code>, <code>"sirius"</code></td>
<td>The <a href="http://www.hmdb.ca/">HMDB</a> contains many human metabolites.</td>
</tr>
<tr class="even">
<td><code>bio</code></td>
<td><code>"sirius"</code></td>
<td>Selects all supports biological databases.</td>
</tr>
<tr class="odd">
<td><code>csv</code>, <code>psv</code>, <code>sdf</code></td>
<td><code>"metfrag"</code></td>
<td>Custom database (see next section). <a href="https://raw.githubusercontent.com/rickhelmus/patRoon/master/tests/testthat/test_data/test-mf-db-isomers.csv">CSV example</a>.</td>
</tr>
</tbody>
</table>
<div id="configuring-metfrag-databases-and-scoring" class="section level4" number="4.5.3.1">
<h4><span class="header-section-number">4.5.3.1</span> Configuring MetFrag databases and scoring</h4>
<p>Some extra configuration may be necessary when using certain databases with MetFrag. In order to use the ChemSpider database a <a href="http://www.chemspider.com/AboutServices.aspx">security token</a> should be requested and set with the <code>chemSpiderToken</code> argument to <code>generateCompounds()</code>. The CompTox and PubChemLite databases need to be manually downloaded from <a href="ftp://newftp.epa.gov/COMPTOX/Sustainable_Chemistry_Data/Chemistry_Dashboard/MetFrag_metadata_files">CompTox</a> (or variations with <a href="https://zenodo.org/record/3364464#.XnjM-XLvKUk">smoking</a> or <a href="https://zenodo.org/record/3472781#.XnjMAHLvKUk">wastewater</a> metadata) and <a href="https://zenodo.org/record/4432124/">PubChemLite</a>. The file location of this and other local databases (<code>csv</code>, <code>psv</code>, <code>sdf</code>) needs to be manually configured, see the examples below and/or <code>?generateCompounds</code> for more information on how to do this.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="annotation.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PubChem: the default</span></span>
<span id="cb34-2"><a href="annotation.html#cb34-2" aria-hidden="true" tabindex="-1"></a>compsMF <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>)</span>
<span id="cb34-3"><a href="annotation.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="annotation.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ChemSpider: needs security token</span></span>
<span id="cb34-5"><a href="annotation.html#cb34-5" aria-hidden="true" tabindex="-1"></a>compsMF2 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">database =</span> <span class="st">&quot;chemspider&quot;</span>,</span>
<span id="cb34-6"><a href="annotation.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">chemSpiderToken =</span> <span class="st">&quot;MY_TOKEN_HERE&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>)</span>
<span id="cb34-7"><a href="annotation.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="annotation.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CompTox: set global option to database path</span></span>
<span id="cb34-9"><a href="annotation.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.path.MetFragCompTox =</span> <span class="st">&quot;~/CompTox_17March2019_SelectMetaData.csv&quot;</span>)</span>
<span id="cb34-10"><a href="annotation.html#cb34-10" aria-hidden="true" tabindex="-1"></a>compsMF3 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">database =</span> <span class="st">&quot;comptox&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>)</span>
<span id="cb34-11"><a href="annotation.html#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="annotation.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CompTox: set database location without global option</span></span>
<span id="cb34-13"><a href="annotation.html#cb34-13" aria-hidden="true" tabindex="-1"></a>compsMF4 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">database =</span> <span class="st">&quot;comptox&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb34-14"><a href="annotation.html#cb34-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">extraOpts =</span> <span class="fu">list</span>(<span class="at">LocalDatabasePath =</span> <span class="st">&quot;~/CompTox_17March2019_SelectMetaData.csv&quot;</span>))</span>
<span id="cb34-15"><a href="annotation.html#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="annotation.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Same, but for custom database</span></span>
<span id="cb34-17"><a href="annotation.html#cb34-17" aria-hidden="true" tabindex="-1"></a>compsMF5 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">database =</span> <span class="st">&quot;csv&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb34-18"><a href="annotation.html#cb34-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">extraOpts =</span> <span class="fu">list</span>(<span class="at">LocalDatabasePath =</span> <span class="st">&quot;~/mydb.csv&quot;</span>))</span></code></pre></div>
<p>An example of a custom <em>.csv</em> database can be found <a href="https://raw.githubusercontent.com/rickhelmus/patRoon/master/tests/testthat/test_data/test-mf-db-isomers.csv">here</a>.</p>
<p>With MetFrag compound databases are not only used to retrieve candidate structures but are also used to obtain metadata for further ranking. Each database has its own scorings, a table with currently supported scorings can be obtained with the <code>compoundScorings()</code> function (some columns omitted):</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-y: auto; height: 350px;">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
metfrag
</th>
<th style="text-align:left;">
database
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
score
</td>
<td style="text-align:left;">
Score
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
fragScore
</td>
<td style="text-align:left;">
FragmenterScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
metFusionScore
</td>
<td style="text-align:left;">
OfflineMetFusionScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
individualMoNAScore
</td>
<td style="text-align:left;">
OfflineIndividualMoNAScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
numberPatents
</td>
<td style="text-align:left;">
PubChemNumberPatents
</td>
<td style="text-align:left;">
pubchem
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
numberPatents
</td>
<td style="text-align:left;">
Patent_Count
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubMedReferences
</td>
<td style="text-align:left;">
PubChemNumberPubMedReferences
</td>
<td style="text-align:left;">
pubchem
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubMedReferences
</td>
<td style="text-align:left;">
ChemSpiderNumberPubMedReferences
</td>
<td style="text-align:left;">
chemspider
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubMedReferences
</td>
<td style="text-align:left;">
NUMBER_OF_PUBMED_ARTICLES
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubMedReferences
</td>
<td style="text-align:left;">
PubMed_Count
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
extReferenceCount
</td>
<td style="text-align:left;">
ChemSpiderNumberExternalReferences
</td>
<td style="text-align:left;">
chemspider
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
dataSourceCount
</td>
<td style="text-align:left;">
ChemSpiderDataSourceCount
</td>
<td style="text-align:left;">
chemspider
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
referenceCount
</td>
<td style="text-align:left;">
ChemSpiderReferenceCount
</td>
<td style="text-align:left;">
chemspider
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
RSCCount
</td>
<td style="text-align:left;">
ChemSpiderRSCCount
</td>
<td style="text-align:left;">
chemspider
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
formulaScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
smartsInclusionScore
</td>
<td style="text-align:left;">
SmartsSubstructureInclusionScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
smartsExclusionScore
</td>
<td style="text-align:left;">
SmartsSubstructureExclusionScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
suspectListScore
</td>
<td style="text-align:left;">
SuspectListScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
retentionTimeScore
</td>
<td style="text-align:left;">
RetentionTimeScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
CPDATCount
</td>
<td style="text-align:left;">
CPDAT_COUNT
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
TOXCASTActive
</td>
<td style="text-align:left;">
TOXCAST_PERCENT_ACTIVE
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
dataSources
</td>
<td style="text-align:left;">
DATA_SOURCES
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubChemDataSources
</td>
<td style="text-align:left;">
PUBCHEM_DATA_SOURCES
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
EXPOCASTPredExpo
</td>
<td style="text-align:left;">
EXPOCAST_MEDIAN_EXPOSURE_PREDICTION_MG/KG-BW/DAY
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ECOTOX
</td>
<td style="text-align:left;">
ECOTOX
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
NORMANSUSDAT
</td>
<td style="text-align:left;">
NORMANSUSDAT
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
MASSBANKEU
</td>
<td style="text-align:left;">
MASSBANKEU
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
TOX21SL
</td>
<td style="text-align:left;">
TOX21SL
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
TOXCAST
</td>
<td style="text-align:left;">
TOXCAST
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIMARKET
</td>
<td style="text-align:left;">
KEMIMARKET
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
MZCLOUD
</td>
<td style="text-align:left;">
MZCLOUD
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
pubMedNeuro
</td>
<td style="text-align:left;">
PubMedNeuro
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
CIGARETTES
</td>
<td style="text-align:left;">
CIGARETTES
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
INDOORCT16
</td>
<td style="text-align:left;">
INDOORCT16
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
SRM2585DUST
</td>
<td style="text-align:left;">
SRM2585DUST
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
SLTCHEMDB
</td>
<td style="text-align:left;">
SLTCHEMDB
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
THSMOKE
</td>
<td style="text-align:left;">
THSMOKE
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ITNANTIBIOTIC
</td>
<td style="text-align:left;">
ITNANTIBIOTIC
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
STOFFIDENT
</td>
<td style="text-align:left;">
STOFFIDENT
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIMARKET_EXPO
</td>
<td style="text-align:left;">
KEMIMARKET_EXPO
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIMARKET_HAZ
</td>
<td style="text-align:left;">
KEMIMARKET_HAZ
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
REACH2017
</td>
<td style="text-align:left;">
REACH2017
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIWW_WDUIndex
</td>
<td style="text-align:left;">
KEMIWW_WDUIndex
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIWW_StpSE
</td>
<td style="text-align:left;">
KEMIWW_StpSE
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KEMIWW_SEHitsOverDL
</td>
<td style="text-align:left;">
KEMIWW_SEHitsOverDL
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
ZINC15PHARMA
</td>
<td style="text-align:left;">
ZINC15PHARMA
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
PFASMASTER
</td>
<td style="text-align:left;">
PFASMASTER
</td>
<td style="text-align:left;">
comptox
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
peakFingerprintScore
</td>
<td style="text-align:left;">
AutomatedPeakFingerprintAnnotationScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
lossFingerprintScore
</td>
<td style="text-align:left;">
AutomatedLossFingerprintAnnotationScore
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
agroChemInfo
</td>
<td style="text-align:left;">
AgroChemInfo
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
bioPathway
</td>
<td style="text-align:left;">
BioPathway
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
drugMedicInfo
</td>
<td style="text-align:left;">
DrugMedicInfo
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
foodRelated
</td>
<td style="text-align:left;">
FoodRelated
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
pharmacoInfo
</td>
<td style="text-align:left;">
PharmacoInfo
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
safetyInfo
</td>
<td style="text-align:left;">
SafetyInfo
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
toxicityInfo
</td>
<td style="text-align:left;">
ToxicityInfo
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
knownUse
</td>
<td style="text-align:left;">
KnownUse
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
disorderDisease
</td>
<td style="text-align:left;">
DisorderDisease
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
identification
</td>
<td style="text-align:left;">
Identification
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
annoTypeCount
</td>
<td style="text-align:left;">
FPSum
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
annoTypeCount
</td>
<td style="text-align:left;">
AnnoTypeCount
</td>
<td style="text-align:left;">
pubchemlite
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
</div>
<p>The first two columns contain the generic and original MetFrag naming schemes for each scoring type. While both naming schemes can be used, the generic is often shorter and harmonized with other algorithms (e.g. SIRIUS). The <em>database</em> column specifies for which databases a particular scoring is available (empty if not database specific). Most scorings are selected by default (as specified by the <em>default</em> column), however, this behaviour can be customized by using the <code>scoreTypes</code> argument:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="annotation.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only in-silico and PubChem number of patents scorings</span></span>
<span id="cb35-2"><a href="annotation.html#cb35-2" aria-hidden="true" tabindex="-1"></a>compsMF1 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb35-3"><a href="annotation.html#cb35-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">scoreTypes =</span> <span class="fu">c</span>(<span class="st">&quot;fragScore&quot;</span> <span class="st">&quot;numberPatents&quot;</span>))</span>
<span id="cb35-4"><a href="annotation.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="annotation.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom scoring in custom database</span></span>
<span id="cb35-6"><a href="annotation.html#cb35-6" aria-hidden="true" tabindex="-1"></a>compsMF2 <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb35-7"><a href="annotation.html#cb35-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">database =</span> <span class="st">&quot;csv&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb35-8"><a href="annotation.html#cb35-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">extraOpts =</span> <span class="fu">list</span>(<span class="at">LocalDatabasePath =</span> <span class="st">&quot;~/mydb.csv&quot;</span>),</span>
<span id="cb35-9"><a href="annotation.html#cb35-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">scoreTypes =</span> <span class="fu">c</span>(<span class="st">&quot;fragScore&quot;</span>, <span class="st">&quot;myScore&quot;</span>, <span class="st">&quot;myScore2&quot;</span>))</span></code></pre></div>
<p>By default ranking is performed with equal weight (i.e. <em>1</em>) for all scorings. This can be changed by the <code>scoreWeights</code> argument, which should be a <code>vector</code> containing the weights for all scorings following the order of <code>scoreTypes</code>, for instance:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="annotation.html#cb36-1" aria-hidden="true" tabindex="-1"></a>compsMF <span class="ot">&lt;-</span> <span class="fu">generateCompounds</span>(fGroups, mslists, <span class="st">&quot;metfrag&quot;</span>, <span class="at">adduct =</span> <span class="st">&quot;[M+H]+&quot;</span>,</span>
<span id="cb36-2"><a href="annotation.html#cb36-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">scoreTypes =</span> <span class="fu">c</span>(<span class="st">&quot;fragScore&quot;</span> <span class="st">&quot;numberPatents&quot;</span>),</span>
<span id="cb36-3"><a href="annotation.html#cb36-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">scoreWeights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p>Sometimes thousands or more structural candidates are found when annotating a feature group. In this situation processing all these candidates will too involving (especially when external databases are used). To avoid this a default cut-off is set: when the number of candidates exceed a certain amount the search will be aborted and no results will be reported for that feature group. The maximum number of candidates can be set with the <code>maxCandidatesToStop</code> argument. The default value is relative conservative, especially for local databases it may be useful to increase this number.</p>
</div>
<div id="timeout-and-error-handling" class="section level4" number="4.5.3.2">
<h4><span class="header-section-number">4.5.3.2</span> Timeout and error handling</h4>
<p>The use of online databases has the drawback that an error may occur, for instance, as a result of a connection error. Furthermore, MetFrag typically returns an error when too many candidates are found (as set by the <code>maxCandidatesToStop</code> argument). By default processing is restarted if an error has occurred (configured by the <code>errorRetries</code> argument). Similarly, the <code>timeoutRetries</code> and <code>timeout</code> arguments can be used to avoid being ‘stuck’ on obtaining results, for instance, due to an unstable internet connection.</p>
<p>If no compounds could be assigned due to an error a warning will be issued. In this case it is best to see what went wrong by manually checking the log files, which by default are stored in the <em>log/metfrag</em> folder.</p>
</div>
<div id="formula-scoring" class="section level4" number="4.5.3.3">
<h4><span class="header-section-number">4.5.3.3</span> Formula scoring</h4>
<p>Ranking of candidate structures may further be improved by incorporating formula information by using the <code>addFormulaScoring()</code> function:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="annotation.html#cb37-1" aria-hidden="true" tabindex="-1"></a>comps <span class="ot">&lt;-</span> <span class="fu">addFormulaScoring</span>(coms, formulas, <span class="at">updateScore =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Here, corresponding formula and explained fragments will be used to calculate a <em>formulaScore</em> for each candidate. Note that SIRIUS candidates are already based on calculated formulae, hence, running this function on SIRIUS results is less sensable unless scoring from another formula calculation algorithm is desired.</p>
</div>
<div id="further-options-and-parameters" class="section level4" number="4.5.3.4">
<h4><span class="header-section-number">4.5.3.4</span> Further options and parameters</h4>
<p>There are <em>many</em> more options and parameters that affect compound annotation. For a full overview please have a look at the reference manual (e.g. by running <code>?generateCompounds</code>).</p>
</div>
</div>
<div id="suspAnn" class="section level3" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> Suspect annotation</h3>
<p>The data obtained during the previously described annotation steps can be used to improve a suspect screening workflow. The <code>annotateSuspects()</code> method uses the annotation data to calculate various annotation properties for each suspect, such as their rank in formula/compound candidates, which fragments from the suspect list were matched, and a <em>rough</em> indication of the identification level according to <span class="citation"><a href="#ref-Schymanski2014" role="doc-biblioref">Schymanski et al.</a> (<a href="#ref-Schymanski2014" role="doc-biblioref">2014</a>)</span></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="annotation.html#cb38-1" aria-hidden="true" tabindex="-1"></a>fGroupsSusp <span class="ot">&lt;-</span> <span class="fu">annotateSuspects</span>(fGroupsSusp, <span class="at">MSPeakLists =</span> mslists,</span>
<span id="cb38-2"><a href="annotation.html#cb38-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formulas =</span> formulas, <span class="at">compounds =</span> compounds)</span></code></pre></div>
<p>The calculation of identification levels is performed by a set of pre-defined rules. The <code>genIDLevelRulesFile()</code> can be used to inspect the default rules or to create your own rules file, which can subsequently passed to <code>annotateSuspects()</code> with the <code>IDFile</code> argument. See <code>?annotateSuspects</code> for more details on the file format and options. The default identification levels can be summarized as follows:</p>
<table>
<colgroup>
<col width="10%" />
<col width="22%" />
<col width="66%" />
</colgroup>
<thead>
<tr class="header">
<th>Level</th>
<th>Description</th>
<th>Rules</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Target match</td>
<td>Retention time deviates &lt;12 seconds from suspect list. At least <code>3</code> (or all if the suspect list contains less) fragments from the suspect list must match.</td>
</tr>
<tr class="even">
<td>2a</td>
<td>Good MS/MS library match</td>
<td>Suspect is top ranked in the <code>compounds</code> results. The <code>individualMoNAScore</code> is at least <code>0.9</code> and all other candidates have no MoNA library score.</td>
</tr>
<tr class="odd">
<td>3a</td>
<td>Fair library match</td>
<td>The <code>individualMoNAScore</code> is at least 0.4.</td>
</tr>
<tr class="even">
<td>3b</td>
<td>Known MS/MS match</td>
<td>At least <code>3</code> (or all if the suspect list contains less) fragments from the suspect list must match.</td>
</tr>
<tr class="odd">
<td>3c</td>
<td>Good in-silico MS/MS match</td>
<td>The annotation MS/MS similarity (<code>annSimComp</code> column) is at least <code>0.7</code>.</td>
</tr>
<tr class="even">
<td>4a</td>
<td>Good formula MS/MS match</td>
<td>Suspect is top ranked formula candidate, annotation MS/MS similarity (<code>annSimForm</code> column) is at least <code>0.7</code> and isotopic match (<code>isoScore</code>) of at least 0.5. The latter two scores are at least <code>0.2</code> higher than next best ranked candidate.</td>
</tr>
<tr class="odd">
<td>4b</td>
<td>Good formula isotopic pattern match</td>
<td>Suspect is top ranked formula candidate and isotopic match (<code>isoScore</code>) of at least <code>0.9</code> and at least <code>0.2</code> higher than next best ranked candidate.</td>
</tr>
<tr class="even">
<td>5</td>
<td>Unknown</td>
<td>All else.</td>
</tr>
</tbody>
</table>
<p>In general, the more data provided by the suspect list and to <code>annotateSuspects()</code>, the better identification level estimation works. For instance, when considering the default rules, either the <code>fragments_mz</code> or <code>fragments_formula</code> column is necessary to be able assign a <code>level 3b</code>. Similarly, the suspect list needs retention times (as well as fragment data) to be able to assign <code>level 1</code>. As you can imagine, providing the annotation workflow objects (i.e. <code>MSPeakLists</code>, <code>formulas</code>, <code>compounds</code>) to <code>annotateSuspects()</code> is necessary for calculation of most levels.</p>
<p>The <code>annotateSuspects()</code> function will log decisions for identification level assignments to the <code>log/</code> sub-directory in the current working directory. This is useful to inspect level assignments and especially useful when you customized any rules.</p>
<blockquote>
<p><strong><em>NOTE</em></strong>: The current identification level rules are <em>only</em> optimized for GenForm and MetFrag annotation algorithms.</p>
</blockquote>

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Schymanski2014" class="csl-entry">
Schymanski, Emma L., Junho Jeon, Rebekka Gulde, Kathrin Fenner, Matthias Ruff, Heinz P. Singer, and Juliane Hollender. 2014. <span>“Identifying Small Molecules via High Resolution Mass Spectrometry: Communicating Confidence.”</span> <em>Environmental Science and Technology</em> 48 (4): 2097–98. <a href="https://doi.org/10.1021/es5002105">https://doi.org/10.1021/es5002105</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="incorpAdductIso.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": false
}
});
});
</script>

</body>

</html>
