<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.2 Feature parameter optimization | patRoon handbook</title>
  <meta name="description" content="8.2 Feature parameter optimization | patRoon handbook" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="8.2 Feature parameter optimization | patRoon handbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.2 Feature parameter optimization | patRoon handbook" />
  
  
  

<meta name="author" content="Rick Helmus" />


<meta name="date" content="2022-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adducts.html"/>
<link rel="next" href="peakQual.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="automatic-installation-windows-only.html"><a href="automatic-installation-windows-only.html"><i class="fa fa-check"></i><b>2.1</b> Automatic installation (Windows only)</a></li>
<li class="chapter" data-level="2.2" data-path="docker-image.html"><a href="docker-image.html"><i class="fa fa-check"></i><b>2.2</b> Docker image</a></li>
<li class="chapter" data-level="2.3" data-path="manual-installation.html"><a href="manual-installation.html"><i class="fa fa-check"></i><b>2.3</b> Manual installation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manual-installation.html"><a href="manual-installation.html#r-prerequisites"><i class="fa fa-check"></i><b>2.3.1</b> R prerequisites</a></li>
<li class="chapter" data-level="2.3.2" data-path="manual-installation.html"><a href="manual-installation.html#other-dependencies"><i class="fa fa-check"></i><b>2.3.2</b> Other dependencies</a></li>
<li class="chapter" data-level="2.3.3" data-path="manual-installation.html"><a href="manual-installation.html#patroon-installation"><i class="fa fa-check"></i><b>2.3.3</b> patRoon installation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-concepts.html"><a href="workflow-concepts.html"><i class="fa fa-check"></i><b>3</b> Workflow concepts</a></li>
<li class="chapter" data-level="4" data-path="generating-workflow-data.html"><a href="generating-workflow-data.html"><i class="fa fa-check"></i><b>4</b> Generating workflow data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preparations.html"><a href="preparations.html"><i class="fa fa-check"></i><b>4.1</b> Preparations</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preparations.html"><a href="preparations.html#data-pre-treatment"><i class="fa fa-check"></i><b>4.1.1</b> Data pre-treatment</a></li>
<li class="chapter" data-level="4.1.2" data-path="preparations.html"><a href="preparations.html#anaInfo"><i class="fa fa-check"></i><b>4.1.2</b> Analysis information</a></li>
<li class="chapter" data-level="4.1.3" data-path="preparations.html"><a href="preparations.html#newProject"><i class="fa fa-check"></i><b>4.1.3</b> Automatic project generation with newProject()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4.2</b> Features</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="features.html"><a href="features.html#finding-and-grouping-features"><i class="fa fa-check"></i><b>4.2.1</b> Finding and grouping features</a></li>
<li class="chapter" data-level="4.2.2" data-path="features.html"><a href="features.html#suspscr"><i class="fa fa-check"></i><b>4.2.2</b> Suspect screening</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="componentization.html"><a href="componentization.html"><i class="fa fa-check"></i><b>4.3</b> Componentization</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="componentization.html"><a href="componentization.html#componentsChrom"><i class="fa fa-check"></i><b>4.3.1</b> Features with similar chromatographic behaviour</a></li>
<li class="chapter" data-level="4.3.2" data-path="componentization.html"><a href="componentization.html#homologues-series"><i class="fa fa-check"></i><b>4.3.2</b> Homologues series</a></li>
<li class="chapter" data-level="4.3.3" data-path="componentization.html"><a href="componentization.html#compClust"><i class="fa fa-check"></i><b>4.3.3</b> Intensity and MS/MS similarity</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html"><i class="fa fa-check"></i><b>4.4</b> Incorporating adduct and isotopic data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#selecting-features-with-preferential-adductsisotopes"><i class="fa fa-check"></i><b>4.4.1</b> Selecting features with preferential adducts/isotopes</a></li>
<li class="chapter" data-level="4.4.2" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#setting-adduct-annotations-for-feature-groups"><i class="fa fa-check"></i><b>4.4.2</b> Setting adduct annotations for feature groups</a></li>
<li class="chapter" data-level="4.4.3" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#useAdductAnn"><i class="fa fa-check"></i><b>4.4.3</b> Using adduct annotations in the workflow</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>4.5</b> Annotation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="annotation.html"><a href="annotation.html#ms-peak-lists"><i class="fa fa-check"></i><b>4.5.1</b> MS peak lists</a></li>
<li class="chapter" data-level="4.5.2" data-path="annotation.html"><a href="annotation.html#formulae"><i class="fa fa-check"></i><b>4.5.2</b> Formulae</a></li>
<li class="chapter" data-level="4.5.3" data-path="annotation.html"><a href="annotation.html#compounds"><i class="fa fa-check"></i><b>4.5.3</b> Compounds</a></li>
<li class="chapter" data-level="4.5.4" data-path="annotation.html"><a href="annotation.html#suspAnn"><i class="fa fa-check"></i><b>4.5.4</b> Suspect annotation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>5</b> Processing workflow data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="inspecting-results.html"><a href="inspecting-results.html"><i class="fa fa-check"></i><b>5.1</b> Inspecting results</a></li>
<li class="chapter" data-level="5.2" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>5.2</b> Filtering</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="filtering.html"><a href="filtering.html#features-1"><i class="fa fa-check"></i><b>5.2.1</b> Features</a></li>
<li class="chapter" data-level="5.2.2" data-path="filtering.html"><a href="filtering.html#suspect-screening"><i class="fa fa-check"></i><b>5.2.2</b> Suspect screening</a></li>
<li class="chapter" data-level="5.2.3" data-path="filtering.html"><a href="filtering.html#annotation-1"><i class="fa fa-check"></i><b>5.2.3</b> Annotation</a></li>
<li class="chapter" data-level="5.2.4" data-path="filtering.html"><a href="filtering.html#components"><i class="fa fa-check"></i><b>5.2.4</b> Components</a></li>
<li class="chapter" data-level="5.2.5" data-path="filtering.html"><a href="filtering.html#negation"><i class="fa fa-check"></i><b>5.2.5</b> Negation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>5.3</b> Subsetting</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="subset.html"><a href="subset.html#prioritization-workflow"><i class="fa fa-check"></i><b>5.3.1</b> Prioritization workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="deleting-data.html"><a href="deleting-data.html"><i class="fa fa-check"></i><b>5.4</b> Deleting data</a></li>
<li class="chapter" data-level="5.5" data-path="unOv.html"><a href="unOv.html"><i class="fa fa-check"></i><b>5.5</b> Unique and overlapping features</a></li>
<li class="chapter" data-level="5.6" data-path="specSim.html"><a href="specSim.html"><i class="fa fa-check"></i><b>5.6</b> MS similarity</a></li>
<li class="chapter" data-level="5.7" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5.7</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="visualization.html"><a href="visualization.html#vis_feat_ann"><i class="fa fa-check"></i><b>5.7.1</b> Features and annatation data</a></li>
<li class="chapter" data-level="5.7.2" data-path="visualization.html"><a href="visualization.html#visComp"><i class="fa fa-check"></i><b>5.7.2</b> Overlapping and unique data</a></li>
<li class="chapter" data-level="5.7.3" data-path="visualization.html"><a href="visualization.html#ms-similarity"><i class="fa fa-check"></i><b>5.7.3</b> MS similarity</a></li>
<li class="chapter" data-level="5.7.4" data-path="visualization.html"><a href="visualization.html#plotClust"><i class="fa fa-check"></i><b>5.7.4</b> Hierarchical clustering results</a></li>
<li class="chapter" data-level="5.7.5" data-path="visualization.html"><a href="visualization.html#generating-eics-in-dataanalysis"><i class="fa fa-check"></i><b>5.7.5</b> Generating EICs in DataAnalysis</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="intReview.html"><a href="intReview.html"><i class="fa fa-check"></i><b>5.8</b> Interactively explore and review data</a></li>
<li class="chapter" data-level="5.9" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>5.9</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="setsWorkflow.html"><a href="setsWorkflow.html"><i class="fa fa-check"></i><b>6</b> Sets workflows</a>
<ul>
<li class="chapter" data-level="6.1" data-path="initiating-a-sets-workflow.html"><a href="initiating-a-sets-workflow.html"><i class="fa fa-check"></i><b>6.1</b> Initiating a sets workflow</a></li>
<li class="chapter" data-level="6.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html"><i class="fa fa-check"></i><b>6.2</b> Generating sets workflow data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#componentization-1"><i class="fa fa-check"></i><b>6.2.1</b> Componentization</a></li>
<li class="chapter" data-level="6.2.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#formula-and-compound-annotation"><i class="fa fa-check"></i><b>6.2.2</b> Formula and compound annotation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="setsAdducts.html"><a href="setsAdducts.html"><i class="fa fa-check"></i><b>6.3</b> Selecting adducts to improve grouping</a></li>
<li class="chapter" data-level="6.4" data-path="processing-data.html"><a href="processing-data.html"><i class="fa fa-check"></i><b>6.4</b> Processing data</a></li>
<li class="chapter" data-level="6.5" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>6.5</b> Advanced</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="advanced.html"><a href="advanced.html#initiating-a-sets-workflow-from-feature-groups"><i class="fa fa-check"></i><b>6.5.1</b> Initiating a sets workflow from feature groups</a></li>
<li class="chapter" data-level="6.5.2" data-path="advanced.html"><a href="advanced.html#inspecting-and-converting-set-objects"><i class="fa fa-check"></i><b>6.5.2</b> Inspecting and converting set objects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="TPs.html"><a href="TPs.html"><i class="fa fa-check"></i><b>7</b> Transformation product screening</a>
<ul>
<li class="chapter" data-level="7.1" data-path="genTPs.html"><a href="genTPs.html"><i class="fa fa-check"></i><b>7.1</b> Obtaining transformation product data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="genTPs.html"><a href="genTPs.html#parent-input"><i class="fa fa-check"></i><b>7.1.1</b> Parent input</a></li>
<li class="chapter" data-level="7.1.2" data-path="genTPs.html"><a href="genTPs.html#processing-data-1"><i class="fa fa-check"></i><b>7.1.2</b> Processing data</a></li>
<li class="chapter" data-level="7.1.3" data-path="genTPs.html"><a href="genTPs.html#TPsCustom"><i class="fa fa-check"></i><b>7.1.3</b> Custom libraries and transformations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html"><i class="fa fa-check"></i><b>7.2</b> Linking parent and transformation product features</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#componentization-2"><i class="fa fa-check"></i><b>7.2.1</b> Componentization</a></li>
<li class="chapter" data-level="7.2.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#TPsProc"><i class="fa fa-check"></i><b>7.2.2</b> Processing data</a></li>
<li class="chapter" data-level="7.2.3" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#omitting-transformation-product-input"><i class="fa fa-check"></i><b>7.2.3</b> Omitting transformation product input</a></li>
<li class="chapter" data-level="7.2.4" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#reporting-tp-components"><i class="fa fa-check"></i><b>7.2.4</b> Reporting TP components</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="TPsExamples.html"><a href="TPsExamples.html"><i class="fa fa-check"></i><b>7.3</b> Example workflows</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx1"><i class="fa fa-check"></i><b>7.3.1</b> Screen predicted TPs for targets</a></li>
<li class="chapter" data-level="7.3.2" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx2"><i class="fa fa-check"></i><b>7.3.2</b> Screening TPs from a library for suspects</a></li>
<li class="chapter" data-level="7.3.3" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx3"><i class="fa fa-check"></i><b>7.3.3</b> Non-target screening of predicted TPs</a></li>
<li class="chapter" data-level="7.3.4" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx4"><i class="fa fa-check"></i><b>7.3.4</b> Non-target screening of TPs by annotation similarities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced_usage.html"><a href="advanced_usage.html"><i class="fa fa-check"></i><b>8</b> Advanced usage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="adducts.html"><a href="adducts.html"><i class="fa fa-check"></i><b>8.1</b> Adducts</a></li>
<li class="chapter" data-level="8.2" data-path="fOpt.html"><a href="fOpt.html"><i class="fa fa-check"></i><b>8.2</b> Feature parameter optimization</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="fOpt.html"><a href="fOpt.html#parameter-sets"><i class="fa fa-check"></i><b>8.2.1</b> Parameter sets</a></li>
<li class="chapter" data-level="8.2.2" data-path="fOpt.html"><a href="fOpt.html#processing-optmization-results"><i class="fa fa-check"></i><b>8.2.2</b> Processing optmization results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="peakQual.html"><a href="peakQual.html"><i class="fa fa-check"></i><b>8.3</b> Chromatographic peak qualities</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="peakQual.html"><a href="peakQual.html#applying-machine-learning-with-metaclean"><i class="fa fa-check"></i><b>8.3.1</b> Applying machine learning with MetaClean</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="exporting-and-converting-feature-data.html"><a href="exporting-and-converting-feature-data.html"><i class="fa fa-check"></i><b>8.4</b> Exporting and converting feature data</a></li>
<li class="chapter" data-level="8.5" data-path="consensus.html"><a href="consensus.html"><i class="fa fa-check"></i><b>8.5</b> Algorithm consensus</a></li>
<li class="chapter" data-level="8.6" data-path="compclust.html"><a href="compclust.html"><i class="fa fa-check"></i><b>8.6</b> Compound clustering</a></li>
<li class="chapter" data-level="8.7" data-path="basic-quantitative-and-regression-analysis.html"><a href="basic-quantitative-and-regression-analysis.html"><i class="fa fa-check"></i><b>8.7</b> Basic quantitative and regression analysis</a></li>
<li class="chapter" data-level="8.8" data-path="FCCalc.html"><a href="FCCalc.html"><i class="fa fa-check"></i><b>8.8</b> Fold changes</a></li>
<li class="chapter" data-level="8.9" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>8.9</b> Caching</a></li>
<li class="chapter" data-level="8.10" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>8.10</b> Parallelization</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="parallelization.html"><a href="parallelization.html#parellization-of-r-functions"><i class="fa fa-check"></i><b>8.10.1</b> Parellization of R functions</a></li>
<li class="chapter" data-level="8.10.2" data-path="parallelization.html"><a href="parallelization.html#multiprocessing"><i class="fa fa-check"></i><b>8.10.2</b> Multiprocessing</a></li>
<li class="chapter" data-level="8.10.3" data-path="parallelization.html"><a href="parallelization.html#notes-when-using-parallelization-with-futures"><i class="fa fa-check"></i><b>8.10.3</b> Notes when using parallelization with futures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">patRoon handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fOpt" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Feature parameter optimization</h2>
<p>Many different parameters exist that may affect the output quality of feature finding and grouping. To avoid time consuming manual experimentation, functionality is provided to largely automate the optimization process. The methodology, which uses design of experiments (DoE), is based on the excellent <a href="IPO">Isotopologue Parameter Optimization (IPO)</a> <code>R</code> package. The functionality of this package is directly integrated in patRoon. Some functionality was added or changed, the most important being support for other feature finding and grouping algorithms besides <a href="https://www.bioconductor.org/packages/release/bioc/html/xcms.html">XCMS</a> and basic optimization support for qualitative parameters. Nevertheless, the core optimization algorithms are largely untouched.</p>
<p>This section will introduce the most important concepts and functionality. Please see the reference manual for more information (e.g. <code>?`feature-optimization`</code>).</p>
<blockquote>
<p><strong><em>NOTE</em></strong> The <a href="https://bio.informatik.uni-jena.de/software/sirius/">SIRIUS</a> and <a href="https://bitbucket.org/SSamanipour/safd.jl/src/master/">SAFD</a> algorithms are currently not (yet) supported.</p>
</blockquote>
<div id="parameter-sets" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Parameter sets</h3>
<p>Before starting an optimization experiment we have to define <em>parameter sets</em>. These sets contain the parameters and (initial) numeric ranges that should be tested. A parameter set is defined as a regular <code>list</code>, and can be easily constructed with the <code>generateFeatureOptPSet()</code> and <code>generateFGroupsOptPSet()</code> functions (for feature finding and feature grouping, respectively).</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="fOpt.html#cb178-1" aria-hidden="true" tabindex="-1"></a>pSet <span class="ot">&lt;-</span> <span class="fu">generateFeatureOptPSet</span>(<span class="st">&quot;openms&quot;</span>) <span class="co"># default test set for OpenMS</span></span>
<span id="cb178-2"><a href="fOpt.html#cb178-2" aria-hidden="true" tabindex="-1"></a>pSet <span class="ot">&lt;-</span> <span class="fu">generateFeatureOptPSet</span>(<span class="st">&quot;openms&quot;</span>, <span class="at">chromSNR =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) <span class="co"># add parameter</span></span>
<span id="cb178-3"><a href="fOpt.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="co"># of course manually making a list is also possible (e.g. if you don&#39;t want to test the default parameters)</span></span>
<span id="cb178-4"><a href="fOpt.html#cb178-4" aria-hidden="true" tabindex="-1"></a>pSet <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">noiseThrInt =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">5000</span>))</span></code></pre></div>
<p>When optimizing with <a href="https://www.bioconductor.org/packages/release/bioc/html/xcms.html">XCMS</a> or <a href="https://github.com/hcji/KPIC2">KPIC2</a> a few things have to be considered. First of all, when using the XCMS3 interface (i.e. <code>algorithm="xcms3"</code>) the underlying method that should be used for finding and grouping features and retention alignment should be set. In case these are not set default methods will be used.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="fOpt.html#cb179-1" aria-hidden="true" tabindex="-1"></a>pSet <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;centWave&quot;</span>, <span class="at">ppm =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>))</span>
<span id="cb179-2"><a href="fOpt.html#cb179-2" aria-hidden="true" tabindex="-1"></a>pSet <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ppm =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>)) <span class="co"># same: centWave is default</span></span>
<span id="cb179-3"><a href="fOpt.html#cb179-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-4"><a href="fOpt.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get defaults, but for different grouping/alignment methods</span></span>
<span id="cb179-5"><a href="fOpt.html#cb179-5" aria-hidden="true" tabindex="-1"></a>pSetFG <span class="ot">&lt;-</span> <span class="fu">generateFGroupsOptPSet</span>(<span class="st">&quot;xcms3&quot;</span>, <span class="at">groupMethod =</span> <span class="st">&quot;nearest&quot;</span>, <span class="at">retAlignMethod =</span> <span class="st">&quot;peakgroups&quot;</span>)</span></code></pre></div>
<p>In addition, when optimizing feature grouping (both <code>XCMS</code> interfaces and <code>KPIC2</code>) we need to set the grouping and retention alignment parameters in two different nested lists: these are <code>groupArgs</code>/<code>retcorArgs</code> (<code>algorithm="xcms"</code>), <code>groupParams</code>/<code>retAlignParams</code> (<code>algorithm="xcms3"</code>) or <code>groupArgs</code>/<code>alignArgs</code> (<code>algorithm="kpic2"</code>).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="fOpt.html#cb180-1" aria-hidden="true" tabindex="-1"></a>pSetFG <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">groupParams =</span> <span class="fu">list</span>(<span class="at">bw =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>))) <span class="co"># xcms3</span></span>
<span id="cb180-2"><a href="fOpt.html#cb180-2" aria-hidden="true" tabindex="-1"></a>pSetFG <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">retcorArgs =</span> <span class="fu">list</span>(<span class="at">gapInit =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))) <span class="co"># xcms</span></span>
<span id="cb180-3"><a href="fOpt.html#cb180-3" aria-hidden="true" tabindex="-1"></a>pSetFG <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">groupArgs =</span> <span class="fu">list</span>(<span class="at">mz_weight =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.9</span>))) <span class="co"># kpic2</span></span></code></pre></div>
<p>When a parameter set has been defined it should be used as input for the <code>optimizeFeatureFinding()</code> or <code>optimizeFeatureGrouping()</code> functions.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="fOpt.html#cb181-1" aria-hidden="true" tabindex="-1"></a>ftOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureFinding</span>(anaInfo, <span class="st">&quot;openms&quot;</span>, pSet)</span>
<span id="cb181-2"><a href="fOpt.html#cb181-2" aria-hidden="true" tabindex="-1"></a>fgOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureGrouping</span>(fList, <span class="st">&quot;openms&quot;</span>, pSetFG) <span class="co"># fList is an existing features object</span></span></code></pre></div>
<p>Similar to <code>findFeatures()</code>, the first argument to <code>optimizeFeatureFinding()</code> should be the <a href="preparations.html#anaInfo">analysis information</a>. Note that it is not uncommon to perform the optimization with only a subset of (representative) analyses (i.e. to reduce processing time).</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="fOpt.html#cb182-1" aria-hidden="true" tabindex="-1"></a>ftOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureFinding</span>(anaInfo[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ], <span class="st">&quot;openms&quot;</span>, pSet) <span class="co"># only use first two analyses</span></span></code></pre></div>
<p>From the parameter set a design of experiment will be automatically created. Obviously, the more parameters are specified, the longer such an experiment will take. After an experiment has finished, the optimization algorithm will start a new experiment where numeric ranges for each parameter are increased or decreased in order to more accurately find optimum values. Hence, the numeric ranges specified in the parameter set are only <em>initial</em> ranges, and will be changed in subsequent experiments. After each experiment iteration the results will be evaluated and a new experiment will be started as long as better results were obtained during the last experiment (although there is a hard limit defined by the <code>maxIterations</code> argument).</p>
<p>For some parameters it is recommended or even necessary to set hard limits on the numeric ranges that are allowed to be tested. For instance, setting a minimum feature intensity threshold is highly recommended to avoid excessive processing time and potentially suboptimal results due to excessive amounts of resulting features. Configuring absolute parameter ranges is done by setting the <code>paramRanges</code> argument.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="fOpt.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set minimum intensity threshold (but no max)</span></span>
<span id="cb183-2"><a href="fOpt.html#cb183-2" aria-hidden="true" tabindex="-1"></a>ftOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureFinding</span>(anaInfo, <span class="st">&quot;openms&quot;</span>,</span>
<span id="cb183-3"><a href="fOpt.html#cb183-3" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">list</span>(<span class="at">noiseThrInt =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">5000</span>), <span class="co"># initial testing range</span></span>
<span id="cb183-4"><a href="fOpt.html#cb183-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">paramRanges =</span> <span class="fu">list</span>(<span class="at">noiseThrInt =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="cn">Inf</span>))) <span class="co"># never test below 500</span></span></code></pre></div>
<p>Depending on the used algorithm, several default absolute limits are imposed. These may be obtained with the <code>getDefFeaturesOptParamRanges()</code> and <code>getDefFGroupsOptParamRanges()</code> functions.</p>
<p>The common operation is to optimize numeric parameters. However, parameters that are not numeric (i.e. <em>qualitative</em>) need a different approach. In this case you will need to define multiple parameter sets, where each set defines a different qualitative value.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="fOpt.html#cb184-1" aria-hidden="true" tabindex="-1"></a>ftOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureFinding</span>(anaInfo, <span class="st">&quot;openms&quot;</span>,</span>
<span id="cb184-2"><a href="fOpt.html#cb184-2" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">list</span>(<span class="at">chromFWHM =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), <span class="at">isotopeFilteringModel =</span> <span class="st">&quot;metabolites (5% RMS)&quot;</span>),</span>
<span id="cb184-3"><a href="fOpt.html#cb184-3" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">list</span>(<span class="at">chromFWHM =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), <span class="at">isotopeFilteringModel =</span> <span class="st">&quot;metabolites (2% RMS)&quot;</span>))</span></code></pre></div>
<p>In the above example there are two parameter sets: both define the numeric <code>chromFWHM</code> parameter, whereas the qualitative <code>isotopeFilteringModel</code> parameter has a different value for each. Note that we had to specify the <code>chromFWHM</code> twice, this can be remediated by using the <code>templateParams</code> argument:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="fOpt.html#cb185-1" aria-hidden="true" tabindex="-1"></a>ftOpt <span class="ot">&lt;-</span> <span class="fu">optimizeFeatureFinding</span>(anaInfo, <span class="st">&quot;openms&quot;</span>,</span>
<span id="cb185-2"><a href="fOpt.html#cb185-2" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">list</span>(<span class="at">isotopeFilteringModel =</span> <span class="st">&quot;metabolites (5% RMS)&quot;</span>),</span>
<span id="cb185-3"><a href="fOpt.html#cb185-3" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">list</span>(<span class="at">isotopeFilteringModel =</span> <span class="st">&quot;metabolites (2% RMS)&quot;</span>),</span>
<span id="cb185-4"><a href="fOpt.html#cb185-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">templateParams =</span> <span class="fu">list</span>(<span class="at">chromFWHM =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>)))</span></code></pre></div>
<p>As its name suggests, the <code>templateParams</code> argument serves as a template parameter set, and its values are essentially combined with each given parameter set. Note that current support for optimizing qualitative parameters is relatively basic and time consuming. This is because tests are essentially repeated for each parameter set (e.g. in the above example the <code>chromFWHM</code> parameter is optimized twice, each time with a different value for <code>isotopeFilteringModel</code>).</p>
</div>
<div id="processing-optmization-results" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Processing optmization results</h3>
<p>The results of an optimization process are stored in objects from the S4 <code>optimizationResult</code> class. Several methods are defined to inspect and visualize these results.</p>
<p>The <code>optimizedParameters()</code> function is used to inspect the best parameter settings. Similarly, the <code>optimizedObject()</code> function can be used to obtain the object that was created with these settings (i.e. a <code>features</code> or <code>featureGroups</code> object).</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="fOpt.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optimizedParameters</span>(ftOpt) <span class="co"># best settings for whole experiment</span></span></code></pre></div>
<pre><code>#&gt; $chromFWHM
#&gt; [1] 3.75
#&gt; 
#&gt; $mzPPM
#&gt; [1] 13.5
#&gt; 
#&gt; $minFWHM
#&gt; [1] 1.4
#&gt; 
#&gt; $maxFWHM
#&gt; [1] 24</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="fOpt.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optimizedObject</span>(ftOpt) <span class="co"># features object with best settings for whole experiment</span></span></code></pre></div>
<pre><code>#&gt; A featuresOpenMS object
#&gt; Hierarchy:
#&gt; features
#&gt;     |-- featuresOpenMS
#&gt; ---
#&gt; Object size (indication): 595 kB
#&gt; Algorithm: openms
#&gt; Total feature count: 3681
#&gt; Average feature count/analysis: 3681
#&gt; Analyses: solvent-pos-1 (1 total)
#&gt; Replicate groups: solvent-pos (1 total)
#&gt; Replicate groups used as blank: solvent-pos (1 total)</code></pre>
<p>Results can also be obtained for specific parameter sets/iterations.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="fOpt.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optimizedParameters</span>(ftOpt, <span class="dv">1</span>) <span class="co"># best settings for first parameter set</span></span></code></pre></div>
<pre><code>#&gt; $chromFWHM
#&gt; [1] 3.75
#&gt; 
#&gt; $mzPPM
#&gt; [1] 13.5
#&gt; 
#&gt; $minFWHM
#&gt; [1] 1.4
#&gt; 
#&gt; $maxFWHM
#&gt; [1] 24</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="fOpt.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optimizedParameters</span>(ftOpt, <span class="dv">1</span>, <span class="dv">1</span>) <span class="co"># best settings for first parameter set and experiment iteration</span></span></code></pre></div>
<pre><code>#&gt; $chromFWHM
#&gt; [1] 5
#&gt; 
#&gt; $mzPPM
#&gt; [1] 10
#&gt; 
#&gt; $minFWHM
#&gt; [1] 1
#&gt; 
#&gt; $maxFWHM
#&gt; [1] 34</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="fOpt.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optimizedObject</span>(ftOpt, <span class="dv">1</span>) <span class="co"># features object with best settings for first parameter set</span></span></code></pre></div>
<pre><code>#&gt; A featuresOpenMS object
#&gt; Hierarchy:
#&gt; features
#&gt;     |-- featuresOpenMS
#&gt; ---
#&gt; Object size (indication): 595 kB
#&gt; Algorithm: openms
#&gt; Total feature count: 3681
#&gt; Average feature count/analysis: 3681
#&gt; Analyses: solvent-pos-1 (1 total)
#&gt; Replicate groups: solvent-pos (1 total)
#&gt; Replicate groups used as blank: solvent-pos (1 total)</code></pre>
<p>The <code>plot()</code> function can be used to visualize optimization results. This function will plot graphs for results of all tested parameter pairs. The graphs can be contour, image or perspective plots (as specified by the <code>type</code> argument).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="fOpt.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ftOpt, <span class="at">paramSet =</span> <span class="dv">1</span>, <span class="at">DoEIteration =</span> <span class="dv">1</span>) <span class="co"># contour plots for first param set/experiment</span></span></code></pre></div>
<p><img src="handbook_files/figure-html/fOptPlot-1.png" width="70%" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="fOpt.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ftOpt, <span class="at">paramSet =</span> <span class="dv">1</span>, <span class="at">DoEIteration =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;persp&quot;</span>) <span class="co"># pretty perspective plots</span></span></code></pre></div>
<p><img src="handbook_files/figure-html/fOptPlot-2.png" width="70%" /></p>
<p>Please refer to the reference manual for more methods to inspect optimization results (e.g. <code>?optimizationResult</code>).</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adducts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="peakQual.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": false
}
});
});
</script>

</body>

</html>
