<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.10 Parallelization | patRoon handbook</title>
  <meta name="description" content="8.10 Parallelization | patRoon handbook" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="8.10 Parallelization | patRoon handbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.10 Parallelization | patRoon handbook" />
  
  
  

<meta name="author" content="Rick Helmus" />


<meta name="date" content="2022-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="caching.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="automatic-installation-windows-only.html"><a href="automatic-installation-windows-only.html"><i class="fa fa-check"></i><b>2.1</b> Automatic installation (Windows only)</a></li>
<li class="chapter" data-level="2.2" data-path="docker-image.html"><a href="docker-image.html"><i class="fa fa-check"></i><b>2.2</b> Docker image</a></li>
<li class="chapter" data-level="2.3" data-path="manual-installation.html"><a href="manual-installation.html"><i class="fa fa-check"></i><b>2.3</b> Manual installation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manual-installation.html"><a href="manual-installation.html#r-prerequisites"><i class="fa fa-check"></i><b>2.3.1</b> R prerequisites</a></li>
<li class="chapter" data-level="2.3.2" data-path="manual-installation.html"><a href="manual-installation.html#other-dependencies"><i class="fa fa-check"></i><b>2.3.2</b> Other dependencies</a></li>
<li class="chapter" data-level="2.3.3" data-path="manual-installation.html"><a href="manual-installation.html#patroon-installation"><i class="fa fa-check"></i><b>2.3.3</b> patRoon installation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-concepts.html"><a href="workflow-concepts.html"><i class="fa fa-check"></i><b>3</b> Workflow concepts</a></li>
<li class="chapter" data-level="4" data-path="generating-workflow-data.html"><a href="generating-workflow-data.html"><i class="fa fa-check"></i><b>4</b> Generating workflow data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preparations.html"><a href="preparations.html"><i class="fa fa-check"></i><b>4.1</b> Preparations</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preparations.html"><a href="preparations.html#data-pre-treatment"><i class="fa fa-check"></i><b>4.1.1</b> Data pre-treatment</a></li>
<li class="chapter" data-level="4.1.2" data-path="preparations.html"><a href="preparations.html#anaInfo"><i class="fa fa-check"></i><b>4.1.2</b> Analysis information</a></li>
<li class="chapter" data-level="4.1.3" data-path="preparations.html"><a href="preparations.html#newProject"><i class="fa fa-check"></i><b>4.1.3</b> Automatic project generation with newProject()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4.2</b> Features</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="features.html"><a href="features.html#finding-and-grouping-features"><i class="fa fa-check"></i><b>4.2.1</b> Finding and grouping features</a></li>
<li class="chapter" data-level="4.2.2" data-path="features.html"><a href="features.html#suspscr"><i class="fa fa-check"></i><b>4.2.2</b> Suspect screening</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="componentization.html"><a href="componentization.html"><i class="fa fa-check"></i><b>4.3</b> Componentization</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="componentization.html"><a href="componentization.html#componentsChrom"><i class="fa fa-check"></i><b>4.3.1</b> Features with similar chromatographic behaviour</a></li>
<li class="chapter" data-level="4.3.2" data-path="componentization.html"><a href="componentization.html#homologues-series"><i class="fa fa-check"></i><b>4.3.2</b> Homologues series</a></li>
<li class="chapter" data-level="4.3.3" data-path="componentization.html"><a href="componentization.html#compClust"><i class="fa fa-check"></i><b>4.3.3</b> Intensity and MS/MS similarity</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html"><i class="fa fa-check"></i><b>4.4</b> Incorporating adduct and isotopic data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#selecting-features-with-preferential-adductsisotopes"><i class="fa fa-check"></i><b>4.4.1</b> Selecting features with preferential adducts/isotopes</a></li>
<li class="chapter" data-level="4.4.2" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#setting-adduct-annotations-for-feature-groups"><i class="fa fa-check"></i><b>4.4.2</b> Setting adduct annotations for feature groups</a></li>
<li class="chapter" data-level="4.4.3" data-path="incorpAdductIso.html"><a href="incorpAdductIso.html#useAdductAnn"><i class="fa fa-check"></i><b>4.4.3</b> Using adduct annotations in the workflow</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>4.5</b> Annotation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="annotation.html"><a href="annotation.html#ms-peak-lists"><i class="fa fa-check"></i><b>4.5.1</b> MS peak lists</a></li>
<li class="chapter" data-level="4.5.2" data-path="annotation.html"><a href="annotation.html#formulae"><i class="fa fa-check"></i><b>4.5.2</b> Formulae</a></li>
<li class="chapter" data-level="4.5.3" data-path="annotation.html"><a href="annotation.html#compounds"><i class="fa fa-check"></i><b>4.5.3</b> Compounds</a></li>
<li class="chapter" data-level="4.5.4" data-path="annotation.html"><a href="annotation.html#suspAnn"><i class="fa fa-check"></i><b>4.5.4</b> Suspect annotation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>5</b> Processing workflow data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="inspecting-results.html"><a href="inspecting-results.html"><i class="fa fa-check"></i><b>5.1</b> Inspecting results</a></li>
<li class="chapter" data-level="5.2" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>5.2</b> Filtering</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="filtering.html"><a href="filtering.html#features-1"><i class="fa fa-check"></i><b>5.2.1</b> Features</a></li>
<li class="chapter" data-level="5.2.2" data-path="filtering.html"><a href="filtering.html#suspect-screening"><i class="fa fa-check"></i><b>5.2.2</b> Suspect screening</a></li>
<li class="chapter" data-level="5.2.3" data-path="filtering.html"><a href="filtering.html#annotation-1"><i class="fa fa-check"></i><b>5.2.3</b> Annotation</a></li>
<li class="chapter" data-level="5.2.4" data-path="filtering.html"><a href="filtering.html#components"><i class="fa fa-check"></i><b>5.2.4</b> Components</a></li>
<li class="chapter" data-level="5.2.5" data-path="filtering.html"><a href="filtering.html#negation"><i class="fa fa-check"></i><b>5.2.5</b> Negation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>5.3</b> Subsetting</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="subset.html"><a href="subset.html#prioritization-workflow"><i class="fa fa-check"></i><b>5.3.1</b> Prioritization workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="deleting-data.html"><a href="deleting-data.html"><i class="fa fa-check"></i><b>5.4</b> Deleting data</a></li>
<li class="chapter" data-level="5.5" data-path="unOv.html"><a href="unOv.html"><i class="fa fa-check"></i><b>5.5</b> Unique and overlapping features</a></li>
<li class="chapter" data-level="5.6" data-path="specSim.html"><a href="specSim.html"><i class="fa fa-check"></i><b>5.6</b> MS similarity</a></li>
<li class="chapter" data-level="5.7" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5.7</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="visualization.html"><a href="visualization.html#vis_feat_ann"><i class="fa fa-check"></i><b>5.7.1</b> Features and annatation data</a></li>
<li class="chapter" data-level="5.7.2" data-path="visualization.html"><a href="visualization.html#visComp"><i class="fa fa-check"></i><b>5.7.2</b> Overlapping and unique data</a></li>
<li class="chapter" data-level="5.7.3" data-path="visualization.html"><a href="visualization.html#ms-similarity"><i class="fa fa-check"></i><b>5.7.3</b> MS similarity</a></li>
<li class="chapter" data-level="5.7.4" data-path="visualization.html"><a href="visualization.html#plotClust"><i class="fa fa-check"></i><b>5.7.4</b> Hierarchical clustering results</a></li>
<li class="chapter" data-level="5.7.5" data-path="visualization.html"><a href="visualization.html#generating-eics-in-dataanalysis"><i class="fa fa-check"></i><b>5.7.5</b> Generating EICs in DataAnalysis</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="intReview.html"><a href="intReview.html"><i class="fa fa-check"></i><b>5.8</b> Interactively explore and review data</a></li>
<li class="chapter" data-level="5.9" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>5.9</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="setsWorkflow.html"><a href="setsWorkflow.html"><i class="fa fa-check"></i><b>6</b> Sets workflows</a>
<ul>
<li class="chapter" data-level="6.1" data-path="initiating-a-sets-workflow.html"><a href="initiating-a-sets-workflow.html"><i class="fa fa-check"></i><b>6.1</b> Initiating a sets workflow</a></li>
<li class="chapter" data-level="6.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html"><i class="fa fa-check"></i><b>6.2</b> Generating sets workflow data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#componentization-1"><i class="fa fa-check"></i><b>6.2.1</b> Componentization</a></li>
<li class="chapter" data-level="6.2.2" data-path="generating-sets-workflow-data.html"><a href="generating-sets-workflow-data.html#formula-and-compound-annotation"><i class="fa fa-check"></i><b>6.2.2</b> Formula and compound annotation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="setsAdducts.html"><a href="setsAdducts.html"><i class="fa fa-check"></i><b>6.3</b> Selecting adducts to improve grouping</a></li>
<li class="chapter" data-level="6.4" data-path="processing-data.html"><a href="processing-data.html"><i class="fa fa-check"></i><b>6.4</b> Processing data</a></li>
<li class="chapter" data-level="6.5" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>6.5</b> Advanced</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="advanced.html"><a href="advanced.html#initiating-a-sets-workflow-from-feature-groups"><i class="fa fa-check"></i><b>6.5.1</b> Initiating a sets workflow from feature groups</a></li>
<li class="chapter" data-level="6.5.2" data-path="advanced.html"><a href="advanced.html#inspecting-and-converting-set-objects"><i class="fa fa-check"></i><b>6.5.2</b> Inspecting and converting set objects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="TPs.html"><a href="TPs.html"><i class="fa fa-check"></i><b>7</b> Transformation product screening</a>
<ul>
<li class="chapter" data-level="7.1" data-path="genTPs.html"><a href="genTPs.html"><i class="fa fa-check"></i><b>7.1</b> Obtaining transformation product data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="genTPs.html"><a href="genTPs.html#parent-input"><i class="fa fa-check"></i><b>7.1.1</b> Parent input</a></li>
<li class="chapter" data-level="7.1.2" data-path="genTPs.html"><a href="genTPs.html#processing-data-1"><i class="fa fa-check"></i><b>7.1.2</b> Processing data</a></li>
<li class="chapter" data-level="7.1.3" data-path="genTPs.html"><a href="genTPs.html#TPsCustom"><i class="fa fa-check"></i><b>7.1.3</b> Custom libraries and transformations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html"><i class="fa fa-check"></i><b>7.2</b> Linking parent and transformation product features</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#componentization-2"><i class="fa fa-check"></i><b>7.2.1</b> Componentization</a></li>
<li class="chapter" data-level="7.2.2" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#TPsProc"><i class="fa fa-check"></i><b>7.2.2</b> Processing data</a></li>
<li class="chapter" data-level="7.2.3" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#omitting-transformation-product-input"><i class="fa fa-check"></i><b>7.2.3</b> Omitting transformation product input</a></li>
<li class="chapter" data-level="7.2.4" data-path="linking-parent-and-transformation-product-features.html"><a href="linking-parent-and-transformation-product-features.html#reporting-tp-components"><i class="fa fa-check"></i><b>7.2.4</b> Reporting TP components</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="TPsExamples.html"><a href="TPsExamples.html"><i class="fa fa-check"></i><b>7.3</b> Example workflows</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx1"><i class="fa fa-check"></i><b>7.3.1</b> Screen predicted TPs for targets</a></li>
<li class="chapter" data-level="7.3.2" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx2"><i class="fa fa-check"></i><b>7.3.2</b> Screening TPs from a library for suspects</a></li>
<li class="chapter" data-level="7.3.3" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx3"><i class="fa fa-check"></i><b>7.3.3</b> Non-target screening of predicted TPs</a></li>
<li class="chapter" data-level="7.3.4" data-path="TPsExamples.html"><a href="TPsExamples.html#TPsEx4"><i class="fa fa-check"></i><b>7.3.4</b> Non-target screening of TPs by annotation similarities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced_usage.html"><a href="advanced_usage.html"><i class="fa fa-check"></i><b>8</b> Advanced usage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="adducts.html"><a href="adducts.html"><i class="fa fa-check"></i><b>8.1</b> Adducts</a></li>
<li class="chapter" data-level="8.2" data-path="fOpt.html"><a href="fOpt.html"><i class="fa fa-check"></i><b>8.2</b> Feature parameter optimization</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="fOpt.html"><a href="fOpt.html#parameter-sets"><i class="fa fa-check"></i><b>8.2.1</b> Parameter sets</a></li>
<li class="chapter" data-level="8.2.2" data-path="fOpt.html"><a href="fOpt.html#processing-optmization-results"><i class="fa fa-check"></i><b>8.2.2</b> Processing optmization results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="peakQual.html"><a href="peakQual.html"><i class="fa fa-check"></i><b>8.3</b> Chromatographic peak qualities</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="peakQual.html"><a href="peakQual.html#applying-machine-learning-with-metaclean"><i class="fa fa-check"></i><b>8.3.1</b> Applying machine learning with MetaClean</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="exporting-and-converting-feature-data.html"><a href="exporting-and-converting-feature-data.html"><i class="fa fa-check"></i><b>8.4</b> Exporting and converting feature data</a></li>
<li class="chapter" data-level="8.5" data-path="consensus.html"><a href="consensus.html"><i class="fa fa-check"></i><b>8.5</b> Algorithm consensus</a></li>
<li class="chapter" data-level="8.6" data-path="compclust.html"><a href="compclust.html"><i class="fa fa-check"></i><b>8.6</b> Compound clustering</a></li>
<li class="chapter" data-level="8.7" data-path="basic-quantitative-and-regression-analysis.html"><a href="basic-quantitative-and-regression-analysis.html"><i class="fa fa-check"></i><b>8.7</b> Basic quantitative and regression analysis</a></li>
<li class="chapter" data-level="8.8" data-path="FCCalc.html"><a href="FCCalc.html"><i class="fa fa-check"></i><b>8.8</b> Fold changes</a></li>
<li class="chapter" data-level="8.9" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>8.9</b> Caching</a></li>
<li class="chapter" data-level="8.10" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>8.10</b> Parallelization</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="parallelization.html"><a href="parallelization.html#parellization-of-r-functions"><i class="fa fa-check"></i><b>8.10.1</b> Parellization of R functions</a></li>
<li class="chapter" data-level="8.10.2" data-path="parallelization.html"><a href="parallelization.html#multiprocessing"><i class="fa fa-check"></i><b>8.10.2</b> Multiprocessing</a></li>
<li class="chapter" data-level="8.10.3" data-path="parallelization.html"><a href="parallelization.html#notes-when-using-parallelization-with-futures"><i class="fa fa-check"></i><b>8.10.3</b> Notes when using parallelization with futures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">patRoon handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="parallelization" class="section level2" number="8.10">
<h2><span class="header-section-number">8.10</span> Parallelization</h2>
<p>Some steps in the non-target screening workflow are inherently computationally intensive. To reduce computational times <code>patRoon</code> is able to perform <em>parallelization</em> for most of the important functionality. This is especially useful if you have a modern system with multiple CPU cores and sufficient RAM.</p>
<p>For various technical reasons several parallelization techniques are used, these can be categorized as <em>parallelization of <code>R</code> functions</em> and <em>multiprocessing</em>. The next sections describe both parallelization approaches in order to let you optimize the workflow.</p>
<div id="parellization-of-r-functions" class="section level3" number="8.10.1">
<h3><span class="header-section-number">8.10.1</span> Parellization of R functions</h3>
<p>Several functions of <code>patRoon</code> support parallelization.</p>
<table>
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>findFeatures</code></td>
<td>Obtain feature data</td>
<td>Only <code>envipick</code> and <code>kpic2</code> algorithms</td>
</tr>
<tr class="even">
<td><code>generateComponents</code></td>
<td>Generate components</td>
<td>Only <code>cliquems</code> algorithm.</td>
</tr>
<tr class="odd">
<td><code>optimizeFeatureFinding</code>, <code>optimizeFeatureGrouping</code></td>
<td>Optimize feature finding/grouping parameters</td>
<td>Discussed <a href="fOpt.html#fOpt">here</a>.</td>
</tr>
<tr class="even">
<td><code>calculatePeakQualities</code></td>
<td>Calculate feature (group) qualities</td>
<td>Discussed <a href="peakQual.html#peakQual">here</a>.</td>
</tr>
</tbody>
</table>
<p>The parallelization is achieved with the <a href="https://github.com/HenrikBengtsson/future">future</a> and <a href="https://github.com/HenrikBengtsson/future.batchtools">future.apply</a> <code>R</code> packages. To enable parallelization of these functions the <code>parallel</code> argument must be set to <code>TRUE</code> and the future framework must be properly configured in advance. For example:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="parallelization.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup three workers to run in parallel</span></span>
<span id="cb224-2"><a href="parallelization.html#cb224-2" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(<span class="st">&quot;multisession&quot;</span>, <span class="at">workers =</span> <span class="dv">3</span>)</span>
<span id="cb224-3"><a href="parallelization.html#cb224-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-4"><a href="parallelization.html#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="co"># find features with enviPick in parallel</span></span>
<span id="cb224-5"><a href="parallelization.html#cb224-5" aria-hidden="true" tabindex="-1"></a>fList <span class="ot">&lt;-</span> <span class="fu">findFeatures</span>(anaInfo, <span class="st">&quot;envipick&quot;</span>, <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>It is important to properly configure the right future plan. Please see the documentation of the <a href="https://github.com/HenrikBengtsson/future">future</a> package for more details.</p>
</div>
<div id="multiprocessing" class="section level3" number="8.10.2">
<h3><span class="header-section-number">8.10.2</span> Multiprocessing</h3>
<p><code>patRoon</code> relies on several external (command-line) tools to generate workflow data. These commands may be executed in <em>parallel</em> to reduce computational times (‘multiprocessing’). The table below outlines the tools that are executed in parallel.</p>
<table>
<colgroup>
<col width="21%" />
<col width="44%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Tool</th>
<th>Used by</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>msConvert</code></td>
<td><code>convertMSFiles(algorithm="pwiz", ...)</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>FileConverter</code></td>
<td><code>convertMSFiles(algorithm="openms", ...)</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>FeatureFinderMetabo</code></td>
<td><code>findFeatures(algorithm="openms", ...)</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>julia</code></td>
<td><code>findFeatures(algorithm="safd", ...)</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>SIRIUS</code></td>
<td><code>findFeatures(algorithm="sirius", ...)</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>MetaboliteAdductDecharger</code></td>
<td><code>generateComponents(algorithm="openms", ...)</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>GenForm</code></td>
<td><code>generateFormulas(agorithm="genform", ...)</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>SIRIUS</code></td>
<td><code>generateFormulas(agorithm="sirius", ...)</code>, <code>generateCompounds(agorithm="sirius", ...)</code></td>
<td>Only if <code>splitBatches=TRUE</code></td>
</tr>
<tr class="odd">
<td><code>MetFrag</code></td>
<td><code>generateCompounds(agorithm="metfrag", ...)</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>pngquant</code></td>
<td><code>reportHTML(...)</code></td>
<td>Only if <code>optimizePng=TRUE</code></td>
</tr>
<tr class="odd">
<td><code>BioTransformer</code></td>
<td><code>generateTPs(algorithm = "biotransformer")</code></td>
<td>Disabled by default (see <code>?generateTPs</code> for details).</td>
</tr>
</tbody>
</table>
<p>Multiprocessing is either performed by executing processes in the background with the <a href="https://github.com/r-lib/processx">processx</a> <code>R</code> package (<em>classic interface</em>) or by futures, which were introduced in the previous section. An overview of the characteristics of both parallelization techniques is shown below.</p>
<table>
<colgroup>
<col width="48%" />
<col width="51%" />
</colgroup>
<thead>
<tr class="header">
<th><code>classic</code></th>
<th><code>future</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>requires little or no configuration</td>
<td>configuration needed to setup</td>
</tr>
<tr class="even">
<td>works with all tools</td>
<td>doesn’t work with <code>pngquant</code> and slower with <code>GenForm</code></td>
</tr>
<tr class="odd">
<td>only supports parallelization on the local computer</td>
<td>allows both local and cluster computing</td>
</tr>
</tbody>
</table>
<p>Which method is used is controlled by the <code>patRoon.MP.method</code> package option. Note that <code>reportHTML()</code> will always use the classic method for <code>pngquant</code>.</p>
<div id="classic-multiprocessing-interface" class="section level4" number="8.10.2.1">
<h4><span class="header-section-number">8.10.2.1</span> Classic multiprocessing interface</h4>
<p>The classic interface is the ‘original’ method implemented in <code>patRoon</code>, and is therefore well tested and optimized. It is easier to setup, works well with all tools, and is therefore the default method. It is enabled as follows:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="parallelization.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.MP.method =</span> <span class="st">&quot;classic&quot;</span>)</span></code></pre></div>
<p>The number of parallel processes is configured through the <code>patRoon.MP.maxProcs</code> option. By default it is set to the number of available CPU cores, which results usually in the best performance. However, you may want to lower this, for instance, to keep your computer more responsive while processing or limit the RAM used by the data processing workflow.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="parallelization.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.MP.maxProcs =</span> <span class="dv">2</span>) <span class="co"># do not execute more than two tools in parallel. </span></span></code></pre></div>
<p>This will change the parallelization for the complete workflow. However, it may be desirable to change this for only a part the workflow. This is easily achieved with the <code>withOpt()</code> function.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="parallelization.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do not execute more than two tools in parallel.</span></span>
<span id="cb227-2"><a href="parallelization.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.MP.maxProcs =</span> <span class="dv">2</span>)</span>
<span id="cb227-3"><a href="parallelization.html#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="parallelization.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ... but execute up to four GenForm processes</span></span>
<span id="cb227-5"><a href="parallelization.html#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="fu">withOpt</span>(<span class="at">MP.maxProcs =</span> <span class="dv">4</span>, {</span>
<span id="cb227-6"><a href="parallelization.html#cb227-6" aria-hidden="true" tabindex="-1"></a>    formulas <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, <span class="st">&quot;genform&quot;</span>, ...)</span>
<span id="cb227-7"><a href="parallelization.html#cb227-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>The <code>withOpt</code> function will temporarily change the given option(s) while executing a given code block and restore it afterwards (it is very similar to the <code>with_options()</code> function from the <a href="https://cran.r-project.org/web/packages/withr/index.html">withr</a> <code>R</code> package). Furthermore, notice how <code>withOpt()</code> does not require you to prefix the option names with <code>patRoon.</code>.</p>
</div>
<div id="multiprocessing-with-futures" class="section level4" number="8.10.2.2">
<h4><span class="header-section-number">8.10.2.2</span> Multiprocessing with futures</h4>
<p>The primary goal of the “future” method is to allow parallel processing on one or more external computers. Since it uses the <a href="https://github.com/HenrikBengtsson/future">future</a> <code>R</code> package, many approaches are supported, such as local parallelization (similar to the <code>classic</code> method), cluster computing via multiple networked computers and more advanced HPC approaches such as <code>slurm</code> via the <a href="https://github.com/HenrikBengtsson/future.batchtools">future.batchtools</a> <code>R</code> package. This parallelization method can be activated as follows:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="parallelization.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.MP.method =</span> <span class="st">&quot;future&quot;</span>)</span>
<span id="cb228-2"><a href="parallelization.html#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="parallelization.html#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set a future plan</span></span>
<span id="cb228-4"><a href="parallelization.html#cb228-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-5"><a href="parallelization.html#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="co"># example 1: start a local cluster with four nodes</span></span>
<span id="cb228-6"><a href="parallelization.html#cb228-6" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(<span class="st">&quot;cluster&quot;</span>, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb228-7"><a href="parallelization.html#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="parallelization.html#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="co"># example 2: start a networked cluster with four nodes on PC with hostname &quot;otherpc&quot;</span></span>
<span id="cb228-9"><a href="parallelization.html#cb228-9" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(<span class="st">&quot;cluster&quot;</span>, <span class="at">workers =</span> <span class="fu">rep</span>(<span class="st">&quot;otherpc&quot;</span>, <span class="dv">4</span>)) </span></code></pre></div>
<p>Please see the documentation of the respective packages (<em>e.g.</em> <a href="https://github.com/HenrikBengtsson/future">future</a> and <a href="https://github.com/HenrikBengtsson/future.batchtools">future.batchtools</a>) for more details on how to configure the workers.</p>
<p>The <code>withOpt()</code> function introduced in the previous subsection can also be used to temporarily switch between parallelization approaches, for instance:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="parallelization.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default to future parallelization</span></span>
<span id="cb229-2"><a href="parallelization.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">patRoon.MP.method =</span> <span class="st">&quot;future&quot;</span>)</span>
<span id="cb229-3"><a href="parallelization.html#cb229-3" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(<span class="st">&quot;cluster&quot;</span>, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb229-4"><a href="parallelization.html#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="parallelization.html#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ... do workflow</span></span>
<span id="cb229-6"><a href="parallelization.html#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="parallelization.html#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co"># do classic parallelization for GenForm</span></span>
<span id="cb229-8"><a href="parallelization.html#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="fu">withOpt</span>(<span class="at">MP.method =</span> <span class="st">&quot;classic&quot;</span>, {</span>
<span id="cb229-9"><a href="parallelization.html#cb229-9" aria-hidden="true" tabindex="-1"></a>    formulas <span class="ot">&lt;-</span> <span class="fu">generateFormulas</span>(fGroups, <span class="st">&quot;genform&quot;</span>, ...)</span>
<span id="cb229-10"><a href="parallelization.html#cb229-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb229-11"><a href="parallelization.html#cb229-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-12"><a href="parallelization.html#cb229-12" aria-hidden="true" tabindex="-1"></a><span class="co"># .. do more workflow</span></span></code></pre></div>
</div>
<div id="logging" class="section level4" number="8.10.2.3">
<h4><span class="header-section-number">8.10.2.3</span> Logging</h4>
<p>Most tools that are executed in parallel will log their output to text files. These files may contain valuable information, for instance, when an error occurred. By default, the logfiles are stored in the <code>log</code> directory placed in the current working directory. However, you can change this location by setting the <code>patRoon.MP.logPath</code> option. If you set this option to <code>FALSE</code> then no logging occurs.</p>
</div>
</div>
<div id="notes-when-using-parallelization-with-futures" class="section level3" number="8.10.3">
<h3><span class="header-section-number">8.10.3</span> Notes when using parallelization with futures</h3>
<p>Some important notes when using the <code>future</code> parallelization method:</p>
<ul>
<li><code>GenForm</code> currently performs less optimal with future multiprocessing to the <code>classic</code> approach. Nevertheless, it may still be interesting to use the <code>future</code> method to move the computations to another system to free up resources on your local system.</li>
<li>Behind the scenes the <a href="https://github.com/HenrikBengtsson/future.batchtools">future.apply</a> package is used to schedule the tools to be executed. The <code>patRoon.MP.futureSched</code> option sets the value for the <code>future.scheduling</code> argument to the <code>future_lapply()</code> function, and therefore allows you to tweak the scheduling.</li>
<li>Make sure that <code>patRoon</code> and in case of multiprocessing that the tool to be executed (<code>MetFrag</code>, <code>SIRIUS</code> etc.) are exactly the <em>same</em> version on all computing hosts.</li>
<li>Make sure that <code>patRoon</code> is properly configured on all hosts, <em>e.g.</em> set the <code>patRoon.path.XXX</code> options to ensure all tools can be found.</li>
<li>For <code>MetFrag</code> annotation: if a local database such as <code>PubChemLite</code> is used, it must be present on each computing node as well. Furthermore, the local computer (even if not used for the computations) <em>also</em> must have this file present. Like the previous point, make sure that the <code>patRoon.path.XXX</code> options are set properly.</li>
<li>If you encounter errors then it may be handy to switch to <code>future::plan("sequential")</code> and see if it works or you get more descriptive error messages.</li>
<li>In order to restart the nodes, for instance after re-configuring <code>patRoon</code>, updating <code>R</code> packages etc, simply re-execute <code>future::plan(...)</code>.</li>
<li>Setting the <code>future.debug</code> package option to <code>TRUE</code> may give you more insight what is happening to find problems.</li>
</ul>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="caching.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": false
}
});
});
</script>

</body>

</html>
