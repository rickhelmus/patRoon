<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Class to store data from a loaded MS library — MSLibrary-class • patRoon</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Class to store data from a loaded MS library — MSLibrary-class"><meta property="og:description" content="Stores the spectra and metadata from the records of an MS library."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Handbook
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rickhelmus/patRoon" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Class to store data from a loaded MS library</h1>
    <small class="dont-index">Source: <a href="https://github.com/rickhelmus/patRoon/blob/HEAD/R/mslibrary.R" class="external-link"><code>R/mslibrary.R</code></a></small>
    <div class="hidden name"><code>MSLibrary-class.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Stores the spectra and metadata from the records of an MS library.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre><code># S4 method for MSLibrary
records(obj)

# S4 method for MSLibrary
spectra(obj)

# S4 method for MSLibrary
length(x)

# S4 method for MSLibrary
names(x)

# S4 method for MSLibrary
show(object)

# S4 method for MSLibrary,ANY,missing,missing
[(x, i, j, ..., drop = TRUE)

# S4 method for MSLibrary,ANY,missing
[[(x, i, j)

# S4 method for MSLibrary
$(x, name)

# S4 method for MSLibrary
as.data.table(x)

# S4 method for MSLibrary
delete(obj, i = NULL, j = NULL, ...)

# S4 method for MSLibrary
filter(
  obj,
  properties = NULL,
  massRange = NULL,
  mzRangeSpec = NULL,
  relMinIntensity = NULL,
  topMost = NULL,
  onlyAnnotated = FALSE,
  negate = FALSE
)

# S4 method for MSLibrary
convertToSuspects(
  obj,
  adduct,
  spectrumType = "MS2",
  avgSpecParams = getDefAvgPListParams(minIntensityPre = 0, minIntensityPost = 2,
    topMost = 10),
  collapse = TRUE,
  suspects = NULL,
  prefCalcChemProps = TRUE
)

# S4 method for MSLibrary
export(obj, type = "msp", out)

# S4 method for MSLibrary,MSLibrary
merge(x, y, ...)</code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x, obj, object</dt>
<dd><p><code>MSLibrary</code> object to be accessed.</p></dd>


<dt>i</dt>
<dd><p>For <code>[</code>/<code>[[</code>: A numeric or character value which is used to select records by
their index or name, respectively (for the order/names see <code><a href="generics.html">names()</a></code>).<br><br> For <code>[</code>: Can also be logical to perform logical selection
(similar to regular vectors). If missing all records are selected.<br><br> For <code>[[</code>: should be a scalar value.</p></dd>


<dt>...</dt>
<dd><p>Unused.</p></dd>


<dt>drop, j</dt>
<dd><p>ignored.</p></dd>


<dt>name</dt>
<dd><p>The record name (partially matched).</p></dd>


<dt>properties</dt>
<dd><p>A named <code>list</code> with properties to be filtered. Each item in the <code>list</code> should be named
with the name of the property, and should be a vector with allowed values. To obtain the possible properties, run
<em>e.g.</em> <code>names(records)</code>. Example: <code>properties=list(Instrument_type=c("LC-ESI-QTOF","LC-ESI-TOF"))</code>. Set to <code>NULL</code> to ignore.</p></dd>


<dt>massRange</dt>
<dd><p>Records with a neutral mass outside this range will be removed. Should be a two-sized <code>numeric</code>
vector with the lower and upper mass range. Set to <code>NULL</code> to ignore.</p></dd>


<dt>mzRangeSpec</dt>
<dd><p>Similar to the <code>massRange</code> argument, but removes any peaks from recorded mass spectra outside
the given <em>m/z</em> range.</p></dd>


<dt>relMinIntensity</dt>
<dd><p>The minimum relative intensity (<samp>0-1</samp>) of a mass peak to be kept. Set to <code>NULL</code> to
ignore.</p></dd>


<dt>topMost</dt>
<dd><p>Only keep <code>topMost</code> number of mass peaks for each spectrum. This filter is applied after others.
Set to <code>NULL</code> to ignore.</p></dd>


<dt>onlyAnnotated</dt>
<dd><p>If <code>TRUE</code> then only recorded spectra that are formula annotated are kept.</p></dd>


<dt>negate</dt>
<dd><p>If <code>TRUE</code> then filters are performed in opposite manner.</p></dd>


<dt>adduct</dt>
<dd><p>An <code><a href="adduct-class.html">adduct</a></code> object (or something that can be converted to it with <code><a href="adduct-utils.html">as.adduct</a></code>).
Any records with a different adduct (<code>Precursor_type</code>) are not considered. Alternatively, <code>adduct</code> can be
set to <code>NULL</code> to not filter out any records. However, in this case <em>no</em> MS/MS fragments will be added to
the returned suspect list.</p></dd>


<dt>spectrumType</dt>
<dd><p>A <code>character</code> vector which limits library records to the given spectrum types
(<code>Spectrum_type</code> field, <em>e.g.</em> <code>"MS2"</code>). Set to <code>NULL</code> to allow all spectrum types.</p></dd>


<dt>avgSpecParams</dt>
<dd><p>A <code>list</code> with parameters used for averaging spectra. See <code><a href="getDefAvgPListParams.html">getDefAvgPListParams</a></code>
for more details.</p></dd>


<dt>collapse</dt>
<dd><p>Whether records with the same first-block <acronym>InChIKey</acronym> should be collapsed. See the
<code>Suspect conversion</code> section for details.</p></dd>


<dt>suspects</dt>
<dd><p>If not <code>NULL</code> then this should be a suspect list (see <code><a href="suspect-screening.html">screenSuspects</a></code>) which will
be amended with spectra data. See the <code>Suspect conversion</code> section for details.</p></dd>


<dt>prefCalcChemProps</dt>
<dd><p>If <code>TRUE</code> then calculated chemical properties such as the formula and
<acronym>InChIKey</acronym> are preferred over what is already present in the input suspect list to <code>convertToSuspects</code>. For efficiency reasons it is
recommended to set this to <code>TRUE</code>. See the <code>Validating and calculating chemical properties</code> section for
more details.</p></dd>


<dt>type</dt>
<dd><p>The export type. Currently just <code>"msp"</code>.</p></dd>


<dt>out</dt>
<dd><p>The file path to the output library file.</p></dd>


<dt>y</dt>
<dd><p>The <code>MSLibrary</code> to be merged with <code>x</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>delete</code> returns the object for which the specified data was removed.</p>


<p><code>filter</code> returns a filtered <code>MSLibrary</code> object.</p>


<p><code>convertToSuspects</code> return a suspect list (<code>data.table</code>), which can be used with</p>
<p></p>
<p><code><a href="suspect-screening.html">screenSuspects</a></code>.</p>


<p><code>merge</code> returns a merged <code>MSLibrary</code> object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This class is used by <code><a href="loadMSLibrary.html">loadMSLibrary</a></code> to store the loaded MS library data.</p>
    </div>
    <div id="methods-by-generic-">
    <h2>Methods (by generic)</h2>
    
<ul><li><p><code>records</code>: Accessor method for the <code>records</code> slot of an <code>MSLibrary</code> class.</p></li>
<li><p><code>spectra</code>: Accessor method for the <code>spectra</code> slot of an <code>MSLibrary</code> class.</p></li>
<li><p><code>length</code>: Obtains the total number of records stored.</p></li>
<li><p><code>names</code>: Obtains the names of the stored records (<code>DB_ID</code> field).</p></li>
<li><p><code>show</code>: Shows summary information for this object.</p></li>
<li><p><code>[</code>: Subset on records.</p></li>
<li><p><code>[[</code>: Extracts a spectrum table for a record.</p></li>
<li><p><code>$</code>: Extracts a spectrum table for a record.</p></li>
<li><p><code>as.data.table</code>: Converts all the data (spectra and metadata) to a single <code>data.table</code>.</p></li>
<li><p><code>delete</code>: Completely deletes specified full records or spectra.</p></li>
<li><p><code>filter</code>: Performs rule-based filtering of records and spectra. This may be especially to improve
annotation with <code><a href="generateCompoundsLibrary.html">generateCompoundsLibrary</a></code>.</p></li>
<li><p><code>convertToSuspects</code>: Converts the MS library data to a suspect list, which can be used with
<code><a href="suspect-screening.html">screenSuspects</a></code>. See the <code>Suspect conversion</code> section for details.</p></li>
<li><p><code>export</code>: Exports the library data to a <code class="file">.msp</code> file. The export is accelerated by an <code>C++</code>
interface with <a href="https://CRAN.R-project.org/package=Rcpp" class="external-link"><span class="pkg">Rcpp</span></a>.</p></li>
<li><p><code>merge</code>: Merges two <code>MSLibrary</code> objects (<code>x</code> and <code>y</code>). The records from <code>y</code> that are
unique are added to <code>x</code>. Records that were already in <code>x</code> are simply ignored. The
<a href="https://splash.fiehnlab.ucdavis.edu/" class="external-link">SPLASH</a> values are used to test equality between records, hence, the
<code>calcSPLASH</code> argument to <code><a href="loadMSLibrary.html">loadMSLibrary</a></code> should be <code>TRUE</code>.</p></li>
</ul></div>
    <div id="slots">
    <h2>Slots</h2>
    

<dl><dt><code>records</code></dt>
<dd><p>A <code>data.table</code> with metadata for all records. Use the <code>records</code> method for access.</p></dd>


<dt><code>spectra</code></dt>
<dd><p>A <code>list</code> with all (annotated) spectra. Each spectrum is stored in a <code>data.table</code>. Use
the <code>spectra</code> method for access.</p></dd>


</dl></div>
    <div id="note">
    <h2>Note</h2>
    <p><code>export</code> does not split any <code>Synon</code> data that was merged when the library was loaded.</p>
    </div>
    <div id="s-class-hierarchy">
    <h2>S4 class hierarchy</h2>
    <p></p><ul><li><p><code><a href="workflowStep-class.html">workflowStep</a></code></p><ul><li><p><strong><code>MSLibrary</code></strong></p></li>
</ul></li>
</ul></div>
    <div id="suspect-conversion">
    <h2>Suspect conversion</h2>
    <p>The <code>convertToSuspects</code> method converts MS library data to a suspect list, which
  can be used with <em>e.g.</em> <code><a href="suspect-screening.html">screenSuspects</a></code>. Furthermore, this function can also amend existing
  suspect lists with spectral data.</p>
<p>Conversion occurs in either of the following three methods:</p><ol><li><p><em>Direct</em> (<code>collapse=FALSE</code> and <code>suspects=NULL</code>): each record is considered a suspect, and the
  resulting suspect list is generated directly by converting the records metadata. The <code>fragments_mz</code> column for
  each suspect is constructed from the mass peaks of the corresponding record.</p></li>
<li><p><em>Collapse</em> (<code>collapse=TRUE</code> and <code>suspects=NULL</code>): All records with the same first-block
  <acronym>InChIKey</acronym> are first merged, and their spectra are averaged using the parameters from the
  <code>avgSpecParams</code> argument (see <code><a href="getDefAvgPListParams.html">getDefAvgPListParams</a></code>). The suspect list is based on the merged
  records, where the <code>fragments_mz</code> column is constructed from the averaged spectra. This is generally a good
  default, especially with large MS libraries.</p></li>
<li><p><em>Amend</em> (<code>suspects</code> is not <code>NULL</code>): only those records are considered if their first-block
  <acronym>InChIKey</acronym> is present in the suspect list. The remaining records and their spectra are then collapsed as
  described for the <em>Collapse</em> method, and the <code>fragments_mz</code> column for each suspect is set from the
  averaged spectra. If a suspect is not present in the library, its <code>fragments_mz</code> value will be empty. Note
  that any existing <code>fragments_mz</code> data will be overwritten.</p></li>
</ol></div>
    <div id="validating-and-calculating-chemical-properties">
    <h2>Validating and calculating chemical properties</h2>
    <p>Chemical properties such as <acronym>SMILES</acronym>,
  <acronym>InChIKey</acronym> and formula in the input suspect list to <code>convertToSuspects</code> are automatically validated and calculated if missing/invalid.</p>
<p>The internal validation/calculation process performs the following steps:</p><ul><li><p>Validation of <acronym>SMILES</acronym>, <acronym>InChI</acronym>, <acronym>InChIKey</acronym> and formula data (if present). Invalid
  entries will be set to <code>NA</code>.</p></li>
<li><p>The <acronym>SMILES</acronym> and <acronym>InChI</acronym> data are used to calculate missing or invalid <acronym>SMILES</acronym>,
  <acronym>InChI</acronym>, <acronym>InChIKey</acronym> and formula data. If <code>prefCalcChemProps=TRUE</code> then existing
  <acronym>InChIKey</acronym> and formula data is overwritten by calculated values whenever possible.</p></li>
<li><p>The chemical formulae which were <em>not</em> calculated are verified and normalized. This process may be time
  consuming, and is potentially largely avoided by setting <code>prefCalcChemProps=TRUE</code>.</p></li>
<li><p>Neutral masses are calculated for missing values (<code>prefCalcChemProps=FALSE</code>) or whenever possible
  (<code>prefCalcChemProps=TRUE</code>).</p></li>
</ul><p>Note that calculation of formulae for molecules that are isotopically labelled is currently only supported for
  deuterium (2H) elements.</p>
<p>This functionality relies heavily on <a href="http://openbabel.org/wiki/Main_Page" class="external-link">OpenBabel</a>, please make sure it is
  installed.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>OBoyle NM, Banck M, James CA, Morley C, Vandermeersch T, Hutchison GR (2011).
“Open Babel: An open chemical toolbox.”
<em>Journal of Cheminformatics</em>, <b>3</b>(1).
<a href="https://doi.org/10.1186/1758-2946-3-33" class="external-link">doi:10.1186/1758-2946-3-33</a>
.</p>
<p>Dirk Eddelbuettel and Romain Francois (2011). Rcpp: Seamless R and C++ Integration. Journal of Statistical Software, 40(8), 1-18,  &lt;doi:10.18637/jss.v040.i08&gt;. <br><br> Eddelbuettel, Dirk (2013) Seamless R and C++ Integration with Rcpp, Springer, New York, ISBN 978-1-4614-6867-7, &lt;doi:10.1007/978-1-4614-6868-4&gt;. <br><br> Dirk Eddelbuettel and James Joseph Balamuta (2018). Extending R with C++: A Brief Introduction to Rcpp. The American Statistician. 72(1), &lt;doi:10.1080/00031305.2017.1375990&gt;.</p>
<p>Wohlgemuth G, Mehta SS, Mejia RF, Neumann S, Pedrosa D, Pluskal T, Schymanski EL, Willighagen EL, Wilson M, Wishart DS, Arita M, Dorrestein PC, Bandeira N, Wang M, Schulze T, Salek RM, Steinbeck C, Nainala VC, Mistrik R, Nishioka T, Fiehn O (2016).
“SPLASH,  a hashed identifier for mass spectra.”
<em>Nature Biotechnology</em>, <b>34</b>(11), 1099--1101.
<a href="https://doi.org/10.1038/nbt.3689" class="external-link">doi:10.1038/nbt.3689</a>
.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="loadMSLibrary.html">loadMSLibrary</a></code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

