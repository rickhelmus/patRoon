<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Base feature annotations class — featureAnnotations-class • patRoon</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Base feature annotations class — featureAnnotations-class"><meta property="og:description" content="Holds information for all feature group annotations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Handbook
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rickhelmus/patRoon" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Base feature annotations class</h1>
    <small class="dont-index">Source: <a href="https://github.com/rickhelmus/patRoon/blob/HEAD/R/feature_annotations.R" class="external-link"><code>R/feature_annotations.R</code></a></small>
    <div class="hidden name"><code>featureAnnotations-class.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Holds information for all feature group annotations.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre><code># S4 method for featureAnnotations
annotations(obj)

# S4 method for featureAnnotations
groupNames(obj)

# S4 method for featureAnnotations
length(x)

# S4 method for featureAnnotations,ANY,missing,missing
[(x, i, j, ..., drop = TRUE)

# S4 method for featureAnnotations,ANY,missing
[[(x, i, j)

# S4 method for featureAnnotations
$(x, name)

# S4 method for featureAnnotations
as.data.table(
  x,
  fGroups = NULL,
  fragments = FALSE,
  countElements = NULL,
  countFragElements = NULL,
  OM = FALSE,
  normalizeScores = "none",
  excludeNormScores = defaultExclNormScores(x)
)

# S4 method for featureAnnotations
delete(obj, i = NULL, j = NULL, ...)

# S4 method for featureAnnotations
filter(
  obj,
  minExplainedPeaks = NULL,
  scoreLimits = NULL,
  elements = NULL,
  fragElements = NULL,
  lossElements = NULL,
  topMost = NULL,
  OM = FALSE,
  negate = FALSE
)

# S4 method for featureAnnotations
plotVenn(obj, ..., labels = NULL, vennArgs = NULL)

# S4 method for featureAnnotations
plotUpSet(
  obj,
  ...,
  labels = NULL,
  nsets = length(list(...)) + 1,
  nintersects = NA,
  upsetArgs = NULL
)</code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>obj, x</dt>
<dd><p><code>featureAnnotations</code> object to be accessed</p></dd>


<dt>i, j</dt>
<dd><p>For <code>[</code>/<code>[[</code>: A numeric or character value which is used to select feature groups by
their index or name, respectively (for the order/names see <code><a href="generics.html">groupNames()</a></code>).<br><br> For <code>[</code>: Can also be logical to perform logical selection
(similar to regular vectors). If missing all feature groups are selected.<br><br> For <code>[[</code>: should be a scalar value.<br><br> For <code>delete</code>: The data to remove from. <code>i</code> are the
feature groups as numeric index, logical or character, <code>j</code> the candidates as numeric indices (rows). If either is
<code>NULL</code> then data for all is removed. <code>j</code> may also be a function: it will be called for each feature group,
with the annotation table (a <code>data.table</code>), the feature group name and any other arguments passed as <code>...</code> to <code>delete</code>. The return value of this
function specifies the candidate indices (rows) to be removed (specified as an <code>integer</code> or <code>logical</code> vector).</p></dd>


<dt>...</dt>
<dd><p>For the <code>"["</code> operator: ignored.</p>
<p>For <code>delete</code>: passed to the function specified as <code>j</code>.</p>  
<p>Others: Any further (and unique) <code>featureAnnotations</code> objects.</p></dd>


<dt>drop</dt>
<dd><p>ignored.</p></dd>


<dt>name</dt>
<dd><p>The feature group name (partially matched).</p></dd>


<dt>fGroups</dt>
<dd><p>The <code><a href="featureGroups-class.html">featureGroups</a></code> object that was used to
generate this object. If not <code>NULL</code> it is used to add feature group
information (retention and <em>m/z</em> values).</p></dd>


<dt>fragments</dt>
<dd><p>If <code>TRUE</code> then information on annotated fragments will be included. Automatically set to
<code>TRUE</code> if <code>countFragElements</code> is set.</p></dd>


<dt>countElements, countFragElements</dt>
<dd><p>A <code>character</code> vector with elements that should be counted for each
candidate's formula. For instance, <code>c("C", "H")</code> adds columns for both carbon and hydrogen amounts of each
formula. Note that the neutral formula (<code>neutral_formula</code> column) is used to count elements of non-fragmented
formulae, whereas the charged formula of fragments (<code>ion_formula</code> column in <code>fragInfo</code> data) is used for
fragments. Set to <code>NULL</code> to not count any elements.</p></dd>


<dt>OM</dt>
<dd><p>For <code>as.data.table</code>: if set to <code>TRUE</code> several columns with information relevant for organic
  matter (OM) characterization will be added (e.g. elemental ratios, classification). This will also make sure that
  <code>countElements</code> contains at least C, H, N, O, P and S.</p>
<p>For <code>filter</code>: If <code>TRUE</code> then several filters are applied to exclude unlikely formula candidates present
  in organic matter (OM). See Source section for details.</p></dd>


<dt>normalizeScores</dt>
<dd><p>A <code>character</code> that specifies how normalization of
annotation scorings occurs. Either
<code>"none"</code> (no normalization),
<code>"max"</code> (normalize to max value) or <code>"minmax"</code> (perform min-max
normalization). Note that normalization of negative scores (e.g. output by
<code class="command">SIRIUS</code>) is always performed as min-max. Furthermore, currently
normalization for <code>compounds</code> takes the original min/max scoring
values into account when candidates were generated. Thus, for
<code>compounds</code> scoring, normalization is not affected when candidate
results were removed after they were generated (<em>e.g.</em> by use of
<code>filter</code>).</p></dd>


<dt>excludeNormScores</dt>
<dd><p>A
  <code>character</code> vector specifying any compound scoring names that
  should <em>not</em> be normalized. Set to <code>NULL</code> to normalize all
  scorings. Note that whether any normalization occurs is set by the
  <code>excludeNormScores</code> argument.</p>
<p>For <code>compounds</code>: By default <code>score</code> and
  <code>individualMoNAScore</code> are set to mimic the behavior of the
  <code class="command">MetFrag</code> web interface.</p></dd>


<dt>minExplainedPeaks</dt>
<dd><p>Minimum number of explained peaks. Set to <code>NULL</code> to ignore.</p></dd>


<dt>scoreLimits</dt>
<dd><p>Filter results by their scores. Should be a named <code>list</code> that contains two-sized numeric
vectors with the minimum/maximum value of a score (use <code>-Inf</code>/<code>Inf</code> for no limits). The names of each
element should follow the name column of the table returned by <code><a href="formulaScorings.html">formulaScorings</a>$name</code> and
<code><a href="compoundScorings.html">compoundScorings</a>()$name</code>. For instance, <code>scoreLimits=list(numberPatents=c(10, Inf))</code> specifies
that <code>numberPatents</code> should be at least <samp>10</samp>. Note that a result without a specified scoring is never
removed. If a score term exists multiple times, <em>i.e.</em> due to a consensus, then a candidate is kept if at
least one of the terms falls within the range. Set to <code>NULL</code> to skip this filter.</p></dd>


<dt>elements</dt>
<dd><p>Only retain candidate formulae (neutral form) that match a
given elemental restriction. The format of <code>elements</code> is a
<code>character</code> string with elements that should be present where each
element is followed by a valid amount or a range thereof. If no number is
specified then <samp>1</samp> is assumed. For instance,
<code>elements="C1-10H2-20O0-2P"</code>, specifies that <samp>1-10</samp>, <samp>2-20</samp>,
<samp>0-2</samp> and <samp>1</samp> carbon, hydrogen, oxygen and phosphorus atoms
should be present, respectively. When <code>length(elements)&gt;1</code> formulas
are tested to follow at least one of the given elemental restrictions. For
instance, <code>elements=c("P", "S")</code> specifies that either one phosphorus
or one sulfur atom should be present. Set to <code>NULL</code> to ignore this
filter.</p></dd>


<dt>fragElements, lossElements</dt>
<dd><p>Specifies elemental restrictions for
fragment or neutral loss formulae (charged form). Candidates are retained
if at least one of the fragment formulae follow (or not follow if
<code>negate=TRUE</code>) the given restrictions. See <code>elements</code> for the
used format.</p></dd>


<dt>topMost</dt>
<dd><p>Only keep a maximum of <code>topMost</code> candidates with highest score (or least highest if
<code>negate=TRUE</code>). Set to <code>NULL</code> to ignore.</p></dd>


<dt>negate</dt>
<dd><p>If <code>TRUE</code> then filters are applied in opposite manner.</p></dd>


<dt>labels</dt>
<dd><p>A <code>character</code> with names to use for labelling. If <code>NULL</code> labels are automatically generated.</p></dd>


<dt>vennArgs</dt>
<dd><p>A <code>list</code> with further arguments passed to <span class="pkg">VennDiagram</span> plotting functions. Set to
<code>NULL</code> to ignore.</p></dd>


<dt>nsets, nintersects</dt>
<dd><p>See <code><a href="https://rdrr.io/pkg/UpSetR/man/upset.html" class="external-link">upset</a></code>.</p></dd>


<dt>upsetArgs</dt>
<dd><p>A list with any further arguments to be passed to
<code><a href="https://rdrr.io/pkg/UpSetR/man/upset.html" class="external-link">upset</a></code>. Set to <code>NULL</code> to ignore.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>as.data.table</code> returns a <code>data.table</code>.</p>


<p><code>delete</code> returns the object for which the specified data was removed.</p>


<p><code>filter</code> returns a filtered <code>featureAnnotations</code> object.</p>


<p><code>plotVenn</code> (invisibly) returns a list with the following fields:</p><ul><li><p><code>gList</code> the <code>gList</code> object that was returned by
  the utilized <span class="pkg">VennDiagram</span> plotting function.</p></li>
<li><p><code>areas</code> The total area for each plotted group.</p></li>
<li><p><code>intersectionCounts</code> The number of intersections between groups.</p></li>
</ul><p>The order for the <code>areas</code> and <code>intersectionCounts</code> fields is the same as the parameter order
from the used plotting function (see <em>e.g.</em></p>
<p></p>
<p><code>draw.pairwise.venn</code> and
<code>draw.triple.venn</code>).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This class stores annotation data for feature groups, such as molecular formulae, SMILES identifiers, compound names
etc. The class of objects that are generated by formula and compound annotation (<code><a href="generateFormulas.html">generateFormulas</a></code> and
<code><a href="generateCompounds.html">generateCompounds</a></code>) are based on this class.</p>
    </div>
    <div id="methods-by-generic-">
    <h2>Methods (by generic)</h2>
    
<ul><li><p><code>annotations(featureAnnotations)</code>: Accessor for the <code>groupAnnotations</code> slot.</p></li>
<li><p><code>groupNames(featureAnnotations)</code>: returns a <code>character</code> vector with the names of the
feature groups for which data is present in this object.</p></li>
<li><p><code>length(featureAnnotations)</code>: Obtain total number of candidates.</p></li>
<li><p><code>x[i</code>: Subset on feature groups.</p></li>
<li><p><code>x[[i</code>: Extracts annotation data for a feature group.</p></li>
<li><p><code>$</code>: Extracts annotation data for a feature group.</p></li>
<li><p><code>as.data.table(featureAnnotations)</code>: Generates a table with all annotation data for each feature group and other
information such as element counts.</p></li>
<li><p><code>delete(featureAnnotations)</code>: Completely deletes specified annotations.</p></li>
<li><p><code>filter(featureAnnotations)</code>: Provides rule based filtering for feature group annotations. Useful to eliminate
unlikely candidates and speed up further processing.</p></li>
<li><p><code>plotVenn(featureAnnotations)</code>: plots a Venn diagram (using <span class="pkg">VennDiagram</span>) outlining unique and shared
candidates of up to five different <code>featureAnnotations</code> objects.</p></li>
<li><p><code>plotUpSet(featureAnnotations)</code>: plots an UpSet diagram (using the <code><a href="https://rdrr.io/pkg/UpSetR/man/upset.html" class="external-link">upset</a></code> function) outlining
unique and shared candidates between different <code>featureAnnotations</code> objects.</p></li>
</ul></div>
    <div id="slots">
    <h2>Slots</h2>
    

<dl><dt><code>groupAnnotations</code></dt>
<dd><p>A <code>list</code> with for each annotated feature group a <code>data.table</code> with annotation data.
Use the <code>annotations</code> method for access.</p></dd>


<dt><code>scoreTypes</code></dt>
<dd><p>A <code>character</code> with all the score types present in this object.</p></dd>


<dt><code>scoreRanges</code></dt>
<dd><p>The minimum and maximum score values of all candidates for each feature group. Used for
normalization.</p></dd>


</dl></div>
    <div id="source">
    <h2>Source</h2>
    <p>Calculation of the aromaticity index (AI) and related double bond equivalents (DBE_AI) is performed
  as described in Koch 2015. Formula classification is performed by the rules described in Abdulla 2013. Filtering of
  OM related molecules is performed as described in Koch 2006 and Kujawinski 2006. (see references).</p>
    </div>
    <div id="s-class-hierarchy">
    <h2>S4 class hierarchy</h2>
    <p></p><ul><li><p><code><a href="workflowStep-class.html">workflowStep</a></code></p><ul><li><p><strong><code>featureAnnotations</code></strong></p><ul><li><p><code><a href="formulas-class.html">formulas</a></code></p><ul><li><p><code><a href="formulas-class.html">formulasConsensus</a></code></p></li>
<li><p><code><a href="formulas-class.html">formulasSet</a></code></p></li>
<li><p><code><a href="formulas-class.html">formulasUnset</a></code></p></li>
</ul></li>
<li><p><code><a href="compounds-class.html">compounds</a></code></p><ul><li><p><code><a href="compounds-class.html">compoundsConsensus</a></code></p></li>
<li><p><code><a href="compoundsMF-class.html">compoundsMF</a></code></p></li>
<li><p><code><a href="compounds-class.html">compoundsSet</a></code></p></li>
<li><p><code><a href="compounds-class.html">compoundsUnset</a></code></p></li>
</ul></li>
</ul></li>
</ul></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Koch BP, Dittmar T (2015).
“From mass to structure: an aromaticity index for high-resolution mass data of natural organic matter.”
<em>Rapid Communications in Mass Spectrometry</em>, <b>30</b>(1), 250--250.
<a href="https://doi.org/10.1002/rcm.7433" class="external-link">doi:10.1002/rcm.7433</a>
.
 <br><br> Abdulla HA, Sleighter RL, Hatcher PG (2013).
“Two Dimensional Correlation Analysis of Fourier Transform Ion Cyclotron Resonance Mass Spectra of Dissolved Organic Matter: A New Graphical Analysis of Trends.”
<em>Analytical Chemistry</em>, <b>85</b>(8), 3895--3902.
<a href="https://doi.org/10.1021/ac303221j" class="external-link">doi:10.1021/ac303221j</a>
.
 <br><br>
  Koch BP, Dittmar T (2006).
“From mass to structure: an aromaticity index for high-resolution mass data of natural organic matter.”
<em>Rapid Communications in Mass Spectrometry</em>, <b>20</b>(5), 926--932.
<a href="https://doi.org/10.1002/rcm.2386" class="external-link">doi:10.1002/rcm.2386</a>
.
 <br><br> Kujawinski EB, Behn MD (2006).
“Automated Analysis of Electrospray Ionization Fourier Transform Ion Cyclotron Resonance Mass Spectra of Natural Organic Matter.”
<em>Analytical Chemistry</em>, <b>78</b>(13), 4363--4373.
<a href="https://doi.org/10.1021/ac0600306" class="external-link">doi:10.1021/ac0600306</a>
.</p>
<p>Conway JR, Lex A, Gehlenborg N (2017).
“UpSetR: an R package for the visualization of intersecting sets and their properties.”
<em>Bioinformatics</em>, <b>33</b>(18), 2938-2940.
<a href="https://doi.org/10.1093/bioinformatics/btx364" class="external-link">doi:10.1093/bioinformatics/btx364</a>
, <a href="http://dx.doi.org/10.1093/bioinformatics/btx364" class="external-link">http://dx.doi.org/10.1093/bioinformatics/btx364</a>.
 <br><br> Lex A, Gehlenborg N, Strobelt H, Vuillemot R, Pfister H (2014).
“UpSet: Visualization of Intersecting Sets.”
<em>IEEE Transactions on Visualization and Computer Graphics</em>, <b>20</b>(12), 1983--1992.
<a href="https://doi.org/10.1109/tvcg.2014.2346248" class="external-link">doi:10.1109/tvcg.2014.2346248</a>
.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="formulas-class.html">formulas-class</a></code> and <code><a href="compounds-class.html">compounds-class</a></code></p>
<p>The derived <code><a href="formulas-class.html">formulas</a></code> and <code><a href="compounds-class.html">compounds</a></code> classes.</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

