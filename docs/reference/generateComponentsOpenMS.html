<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Componentization of adducts, isotopes etc. with OpenMS — generateComponentsOpenMS • patRoon</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Componentization of adducts, isotopes etc. with OpenMS — generateComponentsOpenMS"><meta property="og:description" content="Uses the
MetaboliteAdductDecharger
utility (see http://www.openms.de) to generate components."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Reference

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorial

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Handbook

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rickhelmus/patRoon" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Componentization of adducts, isotopes etc. with OpenMS</h1>
    <small class="dont-index">Source: <a href="https://github.com/rickhelmus/patRoon/blob/HEAD/R/generics.R" class="external-link"><code>R/generics.R</code></a>, <a href="https://github.com/rickhelmus/patRoon/blob/HEAD/R/components-openms.R" class="external-link"><code>R/components-openms.R</code></a></small>
    <div class="hidden name"><code>generateComponentsOpenMS.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Uses the
<a href="https://abibuilder.cs.uni-tuebingen.de/archive/openms/Documentation/nightly/html/TOPP_MetaboliteAdductDecharger.html" class="external-link">MetaboliteAdductDecharger</a>
utility (see <a href="http://www.openms.de" class="external-link">http://www.openms.de</a>) to generate components.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generateComponentsOpenMS</span><span class="op">(</span><span class="va">fGroups</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'featureGroups'</span></span>
<span><span class="fu">generateComponentsOpenMS</span><span class="op">(</span></span>
<span>  <span class="va">fGroups</span>,</span>
<span>  ionization <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chargeMin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chargeMax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chargeSpan <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  qTry <span class="op">=</span> <span class="st">"heuristic"</span>,</span>
<span>  potentialAdducts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minRTOverlap <span class="op">=</span> <span class="fl">0.66</span>,</span>
<span>  retWindow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  absMzDev <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  minSize <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  relMinAdductAbundance <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  adductConflictsUsePref <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  NMConflicts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"preferential"</span>, <span class="st">"mostAbundant"</span>, <span class="st">"mostIntense"</span><span class="op">)</span>,</span>
<span>  prefAdducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M-H]-"</span><span class="op">)</span>,</span>
<span>  extraOpts <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'featureGroupsSet'</span></span>
<span><span class="fu">generateComponentsOpenMS</span><span class="op">(</span></span>
<span>  <span class="va">fGroups</span>,</span>
<span>  ionization <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chargeMin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chargeMax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chargeSpan <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  qTry <span class="op">=</span> <span class="st">"heuristic"</span>,</span>
<span>  potentialAdducts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-fgroups">fGroups<a class="anchor" aria-label="anchor" href="#arg-fgroups"></a></dt>
<dd><p><code><a href="featureGroups-class.html">featureGroups</a></code> object for which components should be generated.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to the non-sets workflow method.</p></dd>


<dt id="arg-ionization">ionization<a class="anchor" aria-label="anchor" href="#arg-ionization"></a></dt>
<dd><p>Which ionization polarity was used to generate the data: should be <code>"positive"</code>
  or <code>"negative"</code>. If the <code>featureGroups</code> object has adduct annotations, and <code>ionization=NULL</code>, the
  ionization will be detected automatically.</p>
<p>This parameter is not supported for sets workflows, as the ionization will always be detected
  automatically.</p></dd>


<dt id="arg-chargemin-chargemax">chargeMin, chargeMax<a class="anchor" aria-label="anchor" href="#arg-chargemin-chargemax"></a></dt>
<dd><p>The minimum/maximum charge to consider. Corresponds to the
<code class="command">algorithm:MetaboliteFeatureDeconvolution:charge_min</code>/<code class="command">algorithm:MetaboliteFeatureDeconvolution:charge_min</code>
 options.</p></dd>


<dt id="arg-chargespan">chargeSpan<a class="anchor" aria-label="anchor" href="#arg-chargespan"></a></dt>
<dd><p>The maximum charge span for a single analyte. Corresponds to
<code class="command">algorithm:MetaboliteFeatureDeconvolution:charge_span_max</code>.</p></dd>


<dt id="arg-qtry">qTry<a class="anchor" aria-label="anchor" href="#arg-qtry"></a></dt>
<dd><p>Sets how charges are determined. Corresponds to <code class="command">algorithm:MetaboliteFeatureDeconvolution:q_try</code>.
Valid options are <code>"heuristic"</code> and <code>"all"</code> (the <code>"feature"</code> option from <code class="command">OpenMS</code> is
currently not supported).</p></dd>


<dt id="arg-potentialadducts">potentialAdducts<a class="anchor" aria-label="anchor" href="#arg-potentialadducts"></a></dt>
<dd><p>The adducts to consider. Should be a <code>numeric</code> vector with probabilities for each
  adduct, <em>e.g.</em> <code>potentialAdducts=c("[M+H]+" = 0.8, "[M+Na]+" = 0.2)</code>. Note that the sum of probabilities
  should always be <samp>1</samp>. Furthermore, note that additions of multiple adducts should be controlled by the
  <code>chargeMin</code>/<code>chargeMax</code> arguments (and <em>not</em> with <code>potentialAdducts</code>), <em>e.g.</em> if
  <code>chargeMax=2</code> then both <code>[M+H]+</code> and <code>[2M+H]2+</code> may be considered. Please see the
  <code class="command">algorithm:MetaboliteFeatureDeconvolution:potential_adducts</code> option of
  <a href="https://abibuilder.cs.uni-tuebingen.de/archive/openms/Documentation/nightly/html/TOPP_MetaboliteAdductDecharger.html" class="external-link">MetaboliteAdductDecharger</a>
   for more details. If <code>NULL</code> then the a default is chosen with <code><a href="defaultOpenMSAdducts.html">defaultOpenMSAdducts</a></code> (which is
  <em>not</em> the same as <code class="command">OpenMS</code>).</p>
<p>Should be a <code>list</code> where each entry specifies the potential adducts for a set. Should either be named
  with the sets names or follow the same order as <code>sets(fGroups)</code>. Example:
  <code>potentialAdducts=list(positive=c("[M+H]+" = 0.8, "[M+Na]+" = 0.2), negative=c("[M-H]-" = 0.8, "[M-H2O-H]-" =
  0.2))</code></p></dd>


<dt id="arg-minrtoverlap-retwindow">minRTOverlap, retWindow<a class="anchor" aria-label="anchor" href="#arg-minrtoverlap-retwindow"></a></dt>
<dd><p>Sets feature retention tolerances when grouping features. Sets the
<code class="command">"algorithm:MetaboliteFeatureDeconvolution:retention_max_diff"</code> and
<code class="command">algorithm:MetaboliteFeatureDeconvolution:min_rt_overlap</code> options.</p></dd>


<dt id="arg-absmzdev">absMzDev<a class="anchor" aria-label="anchor" href="#arg-absmzdev"></a></dt>
<dd><p>Maximum absolute <em>m/z</em> deviation. Sets the <code class="command">algorithm:MetaboliteFeatureDeconvolution:mass_max_diff</code> option</p></dd>


<dt id="arg-minsize">minSize<a class="anchor" aria-label="anchor" href="#arg-minsize"></a></dt>
<dd><p>The minimum size of a component. Smaller components than this size will be removed. See note below.</p></dd>


<dt id="arg-relminadductabundance">relMinAdductAbundance<a class="anchor" aria-label="anchor" href="#arg-relminadductabundance"></a></dt>
<dd><p>The minimum relative abundance (<samp>0-1</samp>) that an adduct should be assigned to
features within the same feature group. See the <code>Feature components</code> section for more details.</p></dd>


<dt id="arg-adductconflictsusepref">adductConflictsUsePref<a class="anchor" aria-label="anchor" href="#arg-adductconflictsusepref"></a></dt>
<dd><p>If set to <code>TRUE</code>, and not all adduct assigments to the features within a feature
group are equal and at least one of those adducts is a preferential adduct (<code>prefAdducts</code> argument), then only
the features with (the lowest ranked) preferential adduct are considered. In all other cases or when
<code>adductConflictsUsePref=FALSE</code> only features with the most frequently assigned adduct is considered. See the
<code>Feature components</code> section for more details.</p></dd>


<dt id="arg-nmconflicts">NMConflicts<a class="anchor" aria-label="anchor" href="#arg-nmconflicts"></a></dt>
<dd><p>The strategies to employ when not all neutral masses within a component are equal. Valid options
are: <code>"preferential"</code>, <code>"mostAbundant"</code> and <code>"mostIntense"</code>. Multiple strategies are possible, and
will be executed in the given order until one succeeds. See the <code>Feature components</code> section for more details.</p></dd>


<dt id="arg-prefadducts">prefAdducts<a class="anchor" aria-label="anchor" href="#arg-prefadducts"></a></dt>
<dd><p>A <code>character</code> vector with one or more <em>preferential adducts</em>. See the <code>Feature
components</code> section for more details.</p></dd>


<dt id="arg-extraopts">extraOpts<a class="anchor" aria-label="anchor" href="#arg-extraopts"></a></dt>
<dd><p>Named character vector with extra command line parameters directly passed to
<code class="command">MetaboliteAdductDecharger</code>. Set to <code>NULL</code> to ignore.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code><a href="components-class.html">componentsFeatures</a></code> derived object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses OpenMS to generate components. This function is called when calling <code>generateComponents</code> with
  <code>algorithm="openms"</code>.</p>
<p>Features that show highly similar chromatographic elution profiles are grouped, and subsequently annotated
  with their adducts.</p>
    </div>
    <div id="feature-components">
    <h2>Feature components</h2>
    <p>The returned components are based on so called <em>feature components</em>. Unlike other
  algorithms, components are first made on a feature level (per analysis), instead of for complete feature groups. In
  the final step the feature components are converted to 'regular' components by employing a consensus approach with
  the following steps:</p>
<p></p><ol><li><p>If an adduct assigned to a feature only occurs as a minority compared to other adduct assigments within the
  same feature group, it is considered as an outlier and removed accordingly (controlled by the
  <code>relMinAdductAbundance</code> argument).</p></li>
<li><p>For features within a feature group, only keep their adduct assignment if it occurs as the most frequent or
  is preferential (controlled by <code>adductConflictsUsePref</code> and <code>prefAdducts</code> arguments).</p></li>
<li><p>Components are made by combining the feature groups for which at least one of their features are jointly
  present in the same feature component.</p></li>
<li><p>Conflicts of neutral mass assignments within a component (<em>i.e.</em> not all are the same) are dealt with.
  Firstly, all feature groups with an unknown neutral mass are split in another component. Then, if conflicts still
  occur, the feature groups with similar neutral mass (determined by <code>absMzDev</code> argument) are grouped. Depending
  on the <code>NMConflicts</code> argument, the group with one or more preferential adduct(s) or that is the largest or
  most intense is selected, whereas others are removed from the component. In case multiple groups contain
  preferential adducts, and <samp>&gt;1</samp> preferential adducts are available, the group with the adduct that matches
  first in <code>prefAdducts</code> 'wins'. In case of ties, one of the next strategies in <code>NMConflicts</code> is tried.</p></li>
<li><p>If a feature group occurs in multiple components it will be removed completely.</p></li>
<li><p>the <code>minSize</code> filter is applied.</p></li>
</ol></div>
    <div id="sets-workflows">
    <h2>Sets workflows</h2>
    <p>In a <a href="sets-workflow.html">sets workflow</a> the componentization is first performed for each
  set independently. The resulting components are then all combined in a <code><a href="components-class.html">componentsSet</a></code> object. Note that
  the components themselves are never merged. The components are renamed to include the set name from which they were
  generated (<em>e.g.</em> <code>"CMP1"</code> becomes <code>"CMP1-positive"</code>).</p>
    </div>
    <div id="parallelization">
    <h2>Parallelization</h2>
    <p>generateComponentsOpenMS uses multiprocessing to parallelize
  computations. Please see the parallelization section in the handbook for
  more details and <a href="patRoon-package.html">patRoon options</a> for configuration
  options.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bielow2010patRoon</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="generateComponents.html">generateComponents</a></code> for more details and other algorithms.</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

