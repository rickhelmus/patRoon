<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Load MS library data from MSP files — loadMSLibraryMSP • patRoon</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Load MS library data from MSP files — loadMSLibraryMSP"><meta property="og:description" content="This function loads, verifies and curates MS library data from MSP files."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Reference

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorial

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Handbook

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rickhelmus/patRoon" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Load MS library data from MSP files</h1>
    <small class="dont-index">Source: <a href="https://github.com/rickhelmus/patRoon/blob/HEAD/R/mslibrary-msp.R" class="external-link"><code>R/mslibrary-msp.R</code></a></small>
    <div class="hidden name"><code>loadMSLibraryMSP.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function loads, verifies and curates MS library data from MSP files.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">loadMSLibraryMSP</span><span class="op">(</span></span>
<span>  <span class="va">file</span>,</span>
<span>  parseComments <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prefCalcChemProps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  neutralChemProps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  potAdducts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  potAdductsLib <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  absMzDev <span class="op">=</span> <span class="fl">0.002</span>,</span>
<span>  calcSPLASH <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>Guessing adducts from neutral/ionic mass differences was inspired from
  <a href="http://ipb-halle.github.io/MetFrag/" class="external-link">MetFrag</a>.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>A <code>character</code> string that specifies the file path to the MSP library.</p></dd>


<dt id="arg-parsecomments">parseComments<a class="anchor" aria-label="anchor" href="#arg-parsecomments"></a></dt>
<dd><p>If <code>TRUE</code> then comments in the file are parsed to obtain additional fields, such as
<acronym>SMILES</acronym>, <code>PubChemCID</code> and <code>Resolution</code>. Note that some records specify this data either in the
comments or as a regular field, hence, to ensure that loaded data is most complete it is recommend to set
<code>parseComments=TRUE</code>.</p></dd>


<dt id="arg-prefcalcchemprops">prefCalcChemProps<a class="anchor" aria-label="anchor" href="#arg-prefcalcchemprops"></a></dt>
<dd><p>If <code>TRUE</code> then calculated chemical properties such as the formula and
<acronym>InChIKey</acronym> are preferred over what is already present in the MS library. For efficiency reasons it is
recommended to set this to <code>TRUE</code>. See the <code>Validating and calculating chemical properties</code> section for
more details.</p></dd>


<dt id="arg-neutralchemprops">neutralChemProps<a class="anchor" aria-label="anchor" href="#arg-neutralchemprops"></a></dt>
<dd><p>If <code>TRUE</code> then the neutral form of the molecule is considered to calculate
<acronym>SMILES</acronym>, formulae etc. Enabling this may improve feature matching when considering common adducts
(<em>e.g.</em> <code>[M+H]+</code>, <code>[M-H]-</code>). See the <code>Validating and calculating chemical properties</code> section
for more details.</p></dd>


<dt id="arg-potadducts-potadductslib">potAdducts, potAdductsLib<a class="anchor" aria-label="anchor" href="#arg-potadducts-potadductslib"></a></dt>
<dd><p>If and how missing adducts (<code>Precursor_type</code> data) are guessed,
  <code>potAdducts</code> should be either:</p><ul><li><p><code>FALSE</code>: do not perform adduct guessing.</p></li>
<li><p><code>TRUE</code>: guesses adducts based on a common set of known adducts (currently based on
  <code><a href="adduct-utils.html">GenFormAdducts</a></code> and <code><a href="adduct-utils.html">MetFragAdducts</a></code>). If <code>potAdductsLib</code> is <code>TRUE</code> then also
  any adducts specified in the library are used.</p></li>
<li><p>A <code>list</code> with <code><a href="adduct-class.html">adduct</a></code> objects or <code>character</code> vector that can be converted with
  <code><a href="adduct-utils.html">as.adduct</a></code>. Only the specified adducts will be used for guessing missing values.</p></li>
</ul></dd>


<dt id="arg-absmzdev">absMzDev<a class="anchor" aria-label="anchor" href="#arg-absmzdev"></a></dt>
<dd><p>The maximum absolute <em>m/z</em> deviation when guessing missing adducts.</p></dd>


<dt id="arg-calcsplash">calcSPLASH<a class="anchor" aria-label="anchor" href="#arg-calcsplash"></a></dt>
<dd><p>If set to <code>TRUE</code> then missing <acronym>SPLASH</acronym> values will be calculated (see below).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The loaded data is returned in an <code><a href="MSLibrary-class.html">MSLibrary</a></code> object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses an efficient <code>C++</code> MSP loader to load MS library data. This function is called when calling <code>loadMSLibrary</code> with
  <code>algorithm="msp"</code>.</p>
<p>This function uses <code>C++</code> with <a href="https://CRAN.R-project.org/package=Rcpp" class="external-link"><span class="pkg">Rcpp</span></a> to efficiently load and parse MSP files, and is mainly
  optimized for loading the <code class="file">.msp</code> files from <a href="https://massbank.eu/MassBank/" class="external-link">MassBank EU</a> and
  <a href="https://mona.fiehnlab.ucdavis.edu/" class="external-link">MoNA</a>. Files from other sources may also work, any feedback on this is
  welcome!</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>The mass spectrum parser currently only supports space separated entries (MSP formerly also allows other
  formats).</p>
    </div>
    <div id="automatic-curation-of-library-data">
    <h2>Automatic curation of library data</h2>
    <p>Several strategies are applied to automatically verify and improve
  library data. This is important, since library records may have inconsistent or erroneous data, which makes them
  unsuitable in automated workflows such as compounds annotation with <code><a href="generateCompoundsLibrary.html">generateCompoundsLibrary</a></code>.</p>
<p>The loaded library data is post-treated as follows:</p><ul><li><p>The <code>DB#</code> field is renamed to <code>DB_ID</code> to improve compatibility with <span style="R">R</span> column names.</p></li>
<li><p>Synonyms (<code>Synon</code> fields) are merged together, mainly to save memory usage.</p></li>
<li><p>Inconsistently formatted <code>NA</code> data (<em>e.g.</em> <code>"n/a"</code>, <code>"N/A"</code> or empty strings) are set to
  regular <span style="R">R</span> <code>NA</code> values.</p></li>
<li><p>The case of record field names are made consistent.</p></li>
<li><p>The <code>Formula</code> and <code>ExactMass</code> fields are renamed to <code>formula</code> and <code>neutralMass</code>,
  respectively. This is for consistency with other data generated with <span class="pkg">patRoon</span>.</p></li>
<li><p><code>character</code> field data is trimmed from leading/trailing whitespace.</p></li>
<li><p>Mass data is verified to be properly numeric, and set to <code>NA</code> otherwise.</p></li>
<li><p>The format of formulae data is made consistent: ionic species (with or without square brackets) or converted
  to a regular formula format.</p></li>
<li><p>Chemical identifiers such as <acronym>SMILES</acronym> and formulae are verified and missing values are calculated if
  possible. See below for more details.</p></li>
<li><p>Shortened data in the <code>Ion_mode</code> field (<acronym>P</acronym>/<acronym>N</acronym>) is converted to the long format
  (<code>POSITIVE</code>/<code>NEGATIVE</code>).</p></li>
<li><p>Many different adduct flavors typically found as <code>Precursor_type</code> data are converted and normalized to
  the generic textual format used by <span class="pkg">patRoon</span> (see <code><a href="adduct-utils.html">as.adduct</a></code>).</p></li>
<li><p>If <code>potAdducts!=FALSE</code> then missing or invalid adduct data in <code>Precursor_type</code> is guessed based on
  the difference between the neutral and ionic mass. If multiple adducts explain the mass difference the result is
  <code>NA</code>.</p></li>
<li><p>Missing ion <em>m/z</em> data (<code>PrecursorMZ</code> field) is calculated from adduct data, if possible.</p></li>
<li><p>Missing <a href="https://splash.fiehnlab.ucdavis.edu/" class="external-link">SPLASH</a> data is calculated with the <span class="pkg">splashR</span> package
  if <code>calcSPLASH=TRUE</code>.</p></li>
</ul></div>
    <div id="validating-and-calculating-chemical-properties">
    <h2>Validating and calculating chemical properties</h2>
    <p>Chemical properties such as <acronym>SMILES</acronym>,
  <acronym>InChIKey</acronym> and formula in the MS library are automatically validated and calculated if missing/invalid.</p>
<p>The internal validation/calculation process performs the following steps:</p><ul><li><p>Validation of <acronym>SMILES</acronym>, <acronym>InChI</acronym>, <acronym>InChIKey</acronym> and formula data (if present). Invalid
  entries will be set to <code>NA</code>.</p></li>
<li><p>If <code>neutralChemProps=TRUE</code> then chemical data (<acronym>SMILES</acronym>, formulae etc.) is neutralized by
  (de-)protonation (using the <code class="command">–neutralized</code> option of <code class="command">OpenBabel</code>). An additional column
  <code>molNeutralized</code> is added to mark those molecules that were neutralized. Note that neutralization requires
  either <acronym>SMILES</acronym> or <acronym>InChI</acronym> data to be available.</p></li>
<li><p>The <acronym>SMILES</acronym> and <acronym>InChI</acronym> data are used to calculate missing or invalid <acronym>SMILES</acronym>,
  <acronym>InChI</acronym>, <acronym>InChIKey</acronym> and formula data. If <code>prefCalcChemProps=TRUE</code> then existing
  <acronym>InChIKey</acronym> and formula data is overwritten by calculated values whenever possible.</p></li>
<li><p>The chemical formulae which were <em>not</em> calculated are verified and normalized. This process may be time
  consuming, and is potentially largely avoided by setting <code>prefCalcChemProps=TRUE</code>.</p></li>
<li><p>Neutral masses are calculated for missing values (<code>prefCalcChemProps=FALSE</code>) or whenever possible
  (<code>prefCalcChemProps=TRUE</code>).</p></li>
</ul><p>Note that calculation of formulae for molecules that are isotopically labelled is currently only supported for
  deuterium (2H) elements.</p>
<p>This functionality relies heavily on <a href="https://github.com/openbabel/openbabel" class="external-link">OpenBabel</a>, please make sure it
  is installed.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Wohlgemuth2016patRoon <br><br> Ruttkies2016patRoon <br><br>
  Rcpp1 <br><br> Rcpp2 <br><br> Rcpp3</p>
<p>OBoyle2011patRoon</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="loadMSLibrary.html">loadMSLibrary</a></code> for more details and other algorithms.</p>
<p>The <code><a href="MSLibrary-class.html">MSLibrary</a></code> documentation for various methods to post-process the data and
  <code><a href="generateCompoundsLibrary.html">generateCompoundsLibrary</a></code> for annotation of features with the library data.</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

