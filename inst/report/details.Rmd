Details
===

<script>
`r readAllFile(system.file("js", "utils-report.js", package = "patRoon"))`
</script>

<style>
/* HACK: to make expander button visible on both dark and light backgrounds */
.rt-expander:after {
    border-top-color: dodgerblue;
}

.mainLayout {
    display: grid;
    padding-bottom: 5px;
    padding-right: 5px;
    grid-template-columns: repeat(10, minmax(0, 1fr));
    grid-template-rows: auto 1fr 1fr;
    grid-template-areas:
        "hd hd   hd   hd   hd   hd   hd   hd   hd   hd"
        "sd sd main main main main cand cand cand cand"
        "sd sd   bt   bt   bt   bt   bt   bt   bt   bt"
}

div:has(> div.detailsHeaderbar) {
    grid-area: hd;
}

div:has(> div.detailsSidebar) {
    grid-area: sd;
}

div:has(> div.detailsBottombar) {
    grid-area: bt;
}

div:has(> div.detailsBottombarFull) {
    grid-area: bt / sd / bt / bt; 
}

div:has(> div.detailsMainTable) {
    grid-area: main;
}

div:has(> div.detailsMainTableNoSB) {
    grid-area: main / sd / main / main;
}

div:has(> div.detailsMainTableOnly) {
    grid-area: main / main / main / cand;
}

div:has(> div.detailsMainTableFull) {
    grid-area: main / sd / main / cand;
}

div:has(> div.detailsCandTable) {
    grid-area: cand;
}

.propTabAndImg {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    align-items: center;
    gap: 15px;
}

.parentSim {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    max-height: 100%;
    padding-top: 25px;
    align-items: flex-start;
    gap: 40px;
}

</style>

```{r results='asis',eval=utils$hasComponentsTPs()}
# add TP component parent infos as JS global
printf("<script>const TPComponParentInfo = JSON.parse('%s');</script>\n", utils$getTPParentInfoJSON())
```

##

```{r, echo = FALSE,eval=TRUE}
# small tools to make handling optional elements easier
maybeIncl <- function(cond, tag) if (cond) tag else NULL
callIncl <- function(f, ..., fixed = NULL) do.call(f, c(pruneList(list(...)), fixed))

doSelParent <- utils$hasComponentsTPs() && (settings$features$chromatograms$large || utils$hasComponentsFromTPs() ||
                                                settings$features$chromatograms$intensityPlots)

mdprintf("Generating report parts: ")

UIArgs <- list(
    width = NULL,
    height = "100%",
    gap = 0,
    class = "mainLayout"
)

UIArgs <- c(UIArgs, utils$pruneUI(c,
    utils$genHeaderbar(),
    utils$genDetailsPlainUI(),
    utils$maybeInclUI(utils$hasSuspects(), utils$genDetailsSuspectsUI()),
    utils$maybeInclUI(utils$hasInternalStandards(), utils$genDetailsISTDsUI()),
    utils$maybeInclUI(utils$hasComponents(), utils$genDetailsComponentsUI()),
    utils$maybeInclUI(utils$hasComponentsTPs(), utils$genDetailsTPsUI()),
    utils$genBottombar()
))

do.call(bslib::layout_column_wrap, UIArgs)

mdprintf("Done!\n")
```


```{r, echo = FALSE,eval=FALSE}
# small tools to make handling optional elements easier
maybeIncl <- function(cond, tag) if (cond) tag else NULL
callIncl <- function(f, ..., fixed = NULL) do.call(f, c(pruneList(list(...)), fixed))

doSelParent <- utils$hasComponentsTPs() && (settings$features$chromatograms$large || utils$hasComponentsFromTPs() ||
                                                settings$features$chromatograms$intensityPlots)

mdprintf("Generating report parts: ")

bslib::layout_column_wrap(
    width = 1,
    height = "100%",
    gap = 0,
    style = "padding-bottom: 5px; padding-right: 5px; grid-template-rows: auto 1fr;",
    

    callIncl(bslib::layout_column_wrap,
        id = "detailsLayout",
        style = "grid-template-columns: 1fr 5fr;",
        heights_equal = "row",
        gap = 5,



        bslib::layout_column_wrap(
            id = "detailsTablesLayout",
            width = 1,
            style = "grid-template-rows: 1fr 1fr;",
            gap = 5,
            callIncl(bslib::layout_column_wrap,
                     fixed = list(width = NULL),
                     # style = htmltools::css(grid_template_columns = "1fr 2fr"),
                     heights_equal = "row",
                     class = "bottomLayout",
                     # maybeIncl(utils$hasSuspects(), bslib::navs_tab_card(
                     #     title = "Selected suspect",
                     #     full_screen = TRUE,
                     #     bslib::nav(
                     #         "Suspect",
                     #         bsCardBodyNoFill(
                     #             class = "propTabAndImg pt-2",
                     #             utils$genSuspInfoTable("suspInfoTab"),
                     #             htmltools::img(id = "struct_view-suspect", style = "min-width: 20%;")
                     #         )
                     #     ),
                     # )),
                     # maybeIncl(utils$hasInternalStandards(), bslib::navs_tab_card(
                     #     title = "Selected internal standard",
                     #     full_screen = TRUE,
                     #     bslib::nav(
                     #         "Internal standard",
                     #         bsCardBodyNoFill(
                     #             class = "propTabAndImg pt-2",
                     #             utils$genISTDInfoTable(),
                     #             htmltools::img(id = "struct_view-istd", style = "min-width: 20%;")
                     #         )
                     #     ),
                     # )),
            ))
    )
)

mdprintf("Done!\n")
```
